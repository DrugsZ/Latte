import{r as Ue,g as He,a as gs}from"./reactVendor.DdXWdMVC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var Yt={exports:{}},ut={};var ve;function Es(){if(ve)return ut;ve=1;var s=Ue(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(a,h,u){var p,f={},g=null,w=null;u!==void 0&&(g=""+u),h.key!==void 0&&(g=""+h.key),h.ref!==void 0&&(w=h.ref);for(p in h)i.call(h,p)&&!r.hasOwnProperty(p)&&(f[p]=h[p]);if(a&&a.defaultProps)for(p in h=a.defaultProps,h)f[p]===void 0&&(f[p]=h[p]);return{$$typeof:t,type:a,key:g,ref:w,props:f,_owner:n.current}}return ut.Fragment=e,ut.jsx=o,ut.jsxs=o,ut}var Me;function As(){return Me||(Me=1,Yt.exports=Es()),Yt.exports}var It=As();class ws{id;_parent;_contentArea;constructor(t){this.id=t}create(t,e){this._parent=t,this._contentArea=this.createContentArea(t,e)}createContentArea(t,e){}}var O=(s=>(s.RECTANGLE="RECTANGLE",s.ELLIPSE="ELLIPSE",s.FRAME="FRAME",s.PAGE="CANVAS",s.DOCUMENT="DOCUMENT",s))(O||{}),le=(s=>(s.SOLID="SOLID",s.GRADIENT_LINEAR="GRADIENT_LINEAR",s.GRADIENT_RADIAL="GRADIENT_RADIAL",s.GRADIENT_ANGULAR="GRADIENT_ANGULAR",s.GRADIENT_DIAMOND="GRADIENT_DIAMOND",s.IMAGE="IMAGE",s))(le||{});const vs={type:"NODE_CHANGES",sessionID:0,guid:{sessionID:0,localID:-1},elements:[]},Ms={guid:{sessionID:0,localID:0},type:"DOCUMENT",name:"Document",visible:!0,opacity:1,transform:{a:1,b:0,tx:0,c:0,d:1,ty:0}},Ss={guid:{sessionID:0,localID:1},parentIndex:{guid:{sessionID:0,localID:0},position:"!"},type:"CANVAS",name:"Page 1",visible:!0,opacity:1,transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},backgrounds:[{type:"SOLID",color:{r:.11764705926179886,g:.11764705926179886,b:.11764705926179886,a:1},opacity:1,visible:!0,blendMode:"NORMAL"}]},Cs={guid:{sessionID:1,localID:3},parentIndex:{guid:{sessionID:0,localID:1},position:"!"},type:"RECTANGLE",name:"Rectangle 1",visible:!0,locked:!1,opacity:1,size:{x:100,y:199},transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},cornerRadius:0,strokeWeight:1,strokeAlign:"INSIDE",strokeJoin:"MITER",fillPaints:[{type:"SOLID",color:{r:.8509804010391235,g:.8509804010391235,b:.8509804010391235,a:1},opacity:1,visible:!0,blendMode:"NORMAL"}],strokePaints:[],topLeftRadius:0,topRightRadius:0,bottomLeftRadius:0,bottomRightRadius:0,strokeTopWeight:1,strokeBottomWeight:1,strokeLeftWeight:1,strokeRightWeight:1,cornerSmoothing:1,strokeStyle:"SOLID",dashCap:"NONE",miterAngle:1},xs={type:"IMAGE",opacity:1,visible:!0,blendMode:"NORMAL",transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},image:{hash:"default",name:"default"},imageScaleMode:"FILL",originalImageWidth:100,originalImageHeight:100};let bs=1;function Q(s){return JSON.parse(JSON.stringify(s))}let Ts=0;const Bt=()=>({sessionID:bs,localID:++Ts}),Is=s=>{const t=Q(xs);return t.image={hash:s.hash,name:s.name},t.originalImageWidth=s.size.x,t.originalImageHeight=s.size.y,t},Os=s=>{const t=Q(Ss);return t.guid=Bt(),s&&(t.parentIndex={...t.parentIndex,...s}),t},Ye=({left:s,top:t,width:e=100,height:i=100},n)=>{const r=Q(Cs);return r.guid=Bt(),r.transform.tx=s,r.transform.ty=t,r.size.x=e,r.size.y=i,r},Ds=()=>Q(Ms),Rs=()=>{const s=Ds(),t=Q(vs),e=Os({guid:s.guid});return t.elements.push(s),t.elements.push(e),t};class b{static Undefined=new b(void 0);element;next;prev;constructor(t){this.element=t,this.next=b.Undefined,this.prev=b.Undefined}}class Ut{#t=b.Undefined;#e=b.Undefined;#s=0;get size(){return this.#s}isEmpty(){return this.#t===b.Undefined}clear(){let t=this.#t.next;for(;t;){const{next:e}=t;t.prev=b.Undefined,t.next=b.Undefined,t=e}this.#t=b.Undefined,this.#e=b.Undefined,this.#s=0}push(t){return this.#n(t,!0)}unshift(t){return this.#n(t,!1)}shift(){if(this.#t===b.Undefined)return;const t=this.#t.element;return this.#i(this.#t),t}pop(){if(this.#e===b.Undefined)return;const t=this.#e.element;return this.#i(this.#e),t}#n(t,e){const i=new b(t);if(this.#t===b.Undefined)this.#t=i,this.#e=i;else if(e){const r=this.#e;this.#e=i,i.prev=r,r.next=i}else{const r=this.#t;this.#t=i,i.next=r,r.prev=i}this.#s+=1;let n=!1;return()=>{n||(n=!0,this.#i(i))}}#i(t){if(t.prev!==b.Undefined&&t.next!==b.Undefined){const e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===b.Undefined&&t.next===b.Undefined?(this.#t=b.Undefined,this.#e=b.Undefined):t.next===b.Undefined?(this.#e=this.#e.prev,this.#e.next=b.Undefined):t.prev===b.Undefined&&(this.#t=this.#t.next,this.#t.prev=b.Undefined);this.#s-=1}*[Symbol.iterator](){let t=this.#t;for(;t!==b.Undefined;)yield t.element,t=t.next}}class Ps{constructor(t,e){this.callback=t,this.callbackThis=e}invoke(t){this.callback.call(this.callbackThis,t)}}class D{_event;_listeners;get event(){return this._event||(this._event=(t,e)=>{this._listeners||(this._listeners=new Ut);const i=new Ps(t,e);return this._listeners.push(i)}),this._event}fire(t){if(this._listeners)for(const e of this._listeners)e.invoke(t)}}var dt=(s=>(s[s.DELETE=0]="DELETE",s[s.CREATE=1]="CREATE",s[s.UPDATE=2]="UPDATE",s))(dt||{});class Ot{constructor(t,e,i,n){this.type=t,this.oldValue=i,this.newValue=n,this.target=typeof e=="string"?e:JSON.stringify(e)}target}class ot{static update(t,e){return{type:2,id:JSON.stringify(t),value:e}}static delete(t,e){return{type:0,id:JSON.stringify(t),value:null}}static create(t,e){return{type:1,id:JSON.stringify(t),value:e}}}class Bs{_resultLen;_currLen;_prevLen;_prevEdits;_currEdits;_result;_getCurr(t){return t<this._currLen?this._currEdits[t]:null}_getPrev(t){return t<this._prevLen?this._prevEdits[t]:null}_acceptEdit(t){this._result[this._resultLen++]=t}_mergeValue=(t,e)=>!t||!e?t:{...t,...e};_mergeEdit=(t,e)=>{this._result[this._resultLen++]=new Ot(e.type,e.target,this._mergeValue(t.oldValue,e.oldValue),this._mergeValue(t.newValue,e.newValue))};compress=(t,e)=>{if(t===null||t.length===0)return e;this._result=[],this._prevEdits=t,this._prevLen=this._prevEdits.length,this._currEdits=e,this._currLen=this._currEdits.length;let i=0,n=0;this._resultLen=0;let r=this._getPrev(i),o=this._getCurr(n);for(;i<t.length||n<e.length;){if(!r){this._acceptEdit(o),o=this._getCurr(++n);continue}if(!o){this._acceptEdit(r),r=this._getPrev(++i);continue}r.target===o.target?(this._mergeEdit(r,o),o=this._getCurr(++n),r=this._getPrev(++i)):(this._acceptEdit(r),r=this._getPrev(++i))}return this._result}}const Ns=new Bs,Ls=Ns.compress;class U{changes=[];append(t,e){e.length>0&&(this.changes=Ls(this.changes,e))}serialize(){return JSON.stringify(this.changes)}static deserialize(t){const e=new U;return e.changes=JSON.parse(t),e}}class Vs{constructor(t){this._model=t,this._data=new U}_data;close(){this._data instanceof U&&(this._data=this._data.serialize())}append(t,e){this._data instanceof U&&this._data.append(t,e)}canAppend(){return this._data instanceof U}undo(){this._data instanceof U&&(this._data=this._data.serialize());const t=U.deserialize(this._data);this._model.applyUndo(t.changes)}redo(){this._data instanceof U&&(this._data=this._data.serialize());const t=U.deserialize(this._data);this._model.applyRedo(t.changes)}}class Se{_past=[];_future=[];versionId=0;pushElement(t){this._future=[],this._past.push(t),this.versionId++}getClosestPastElement(){return this._past.length===0?null:this._past[this._past.length-1]}getClosestFutureElement(){return this._future.length===0?null:this._future[this._future.length-1]}moveBackward(t){this._past.pop(),this._future.push(t),this.versionId++}moveForward(t){this._future.pop(),this._past.push(t),this.versionId++}}class Fs{constructor(t){this._model=t}_editStacks=new Map;pushElement(t,e){let i;this._editStacks.has(e)?i=this._editStacks.get(e):(i=new Se,this._editStacks.set(e,i)),i.pushElement(t)}getLastElement(t){return this._editStacks.has(t)?this._editStacks.get(t).getClosestPastElement():null}getOrCreateEditStackElement(t){const e=this.getLastElement(t);if(e&&e.canAppend())return e;const i=new Vs(this._model);return this.pushElement(i,t),i}getOrCreateEditStack(t){if(this._editStacks.has(t))return this._editStacks.get(t);const e=new Se;return this._editStacks.set(t,e),e}pushEditOperation(t){const e=this._model.applyEdits(t,!0);this.getOrCreateEditStackElement(this._model).append(this._model,e.sort((n,r)=>JSON.stringify(n.target).localeCompare(JSON.stringify(r.target))))}redo(){if(!this._editStacks.has(this._model))return;const t=this._editStacks.get(this._model),e=t.getClosestFutureElement();e&&(t.moveForward(e),e.redo())}undo(){if(!this._editStacks.has(this._model))return;const t=this._editStacks.get(this._model),e=t.getClosestPastElement();e&&(t.moveBackward(e),e.undo())}pushStackElement(){const t=this.getLastElement(this._model);t?.canAppend()&&t.close()}}class ks{_model=Rs();_undoRedoService=new Fs(this);_onSchemaContentChange=new D;onSchemaContentChange=this._onSchemaContentChange.event;constructor(t){this._initModel(t)}getCurrentState(){return this._model}_initModel(t){t&&(this._model=t)}pushEditOperations(t){this._undoRedoService.pushEditOperation(t)}applyEdits(t,e){return this._doApplyEdits(t,e)}_acceptSingleEditToModel(t,e){const{value:i}=t,n=this._model?.elements[e];let r=n;return i?n?r={...n,...i}:r=i:r=null,~e?r?this._model.elements[e]=r:this._model.elements.splice(e,1):r&&this._model.elements.push(r),r}_computeSingleEditOperation(t,e,i){const{value:n,type:r}=t;if(!i)return new Ot(r,e.guid,e,i);if(!e)return new Ot(r,i.guid,null,i);const o=Reflect.ownKeys(n),a={};for(let h=0;h<o.length;h++){const u=o[h];a[u]=e[u]}return new Ot(r,e.guid,a,n)}_acceptEditsToModel(t,e){const i=[],n=[];for(let r=0;r<t.length;r++){const o=t[r],a=this._model?.elements.findIndex(u=>o.id===JSON.stringify(u.guid)),h=this._model?.elements[a];n[r]=this._acceptSingleEditToModel(o,a),e&&(i[r]=this._computeSingleEditOperation(o,h,n[r]))}return i}_doApplyEdits(t,e){const i=this._acceptEditsToModel(t,e),n=t.map(r=>({target:r.id}));return this._onSchemaContentChange.fire(n),i}_useUndoType(t){return t===dt.CREATE?dt.DELETE:t===dt.DELETE?dt.CREATE:t}applyUndo(t){const e=t.map(i=>({id:i.target,type:this._useUndoType(i.type),value:i.oldValue}));this.applyEdits(e,!1)}applyRedo(t){const e=t.map(i=>({id:i.target,type:i.type,value:i.newValue}));this.applyEdits(e,!1)}pushStackElement(){this._undoRedoService.pushStackElement()}undo(){this._undoRedoService.undo()}redo(){this._undoRedoService.redo()}getElementSchemaById(t){return this._model.elements.find(e=>JSON.stringify(e.guid)===t)}}class Ks{_onEvent=new D;onEvent=this._onEvent.event;_eventHandlers=[];_viewEventQueue=null;_isConsumingViewEventQueue;addViewEventHandler(t){for(let e=0,i=this._eventHandlers.length;e<i;e++)this._eventHandlers[e]===t&&console.warn("Detected duplicate listener in ViewEventDispatcher",t);this._eventHandlers.push(t)}removeViewEventHandler(t){for(let e=0;e<this._eventHandlers.length;e++)if(this._eventHandlers[e]===t){this._eventHandlers.splice(e,1);break}}emitViewEvent(t){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(t):this._viewEventQueue=[t],this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const t=this._viewEventQueue;this._viewEventQueue=null,this._eventHandlers.slice(0).forEach(i=>{i.handleEvents(t)})}}}var K=(s=>(s[s.ViewFocusPageChange=0]="ViewFocusPageChange",s[s.ViewCameraChange=1]="ViewCameraChange",s[s.ViewElementChange=2]="ViewElementChange",s[s.ViewActiveSelectionChange=3]="ViewActiveSelectionChange",s[s.ViewHoverObjectChange=4]="ViewHoverObjectChange",s[s.ViewHoverControllerKeyChange=5]="ViewHoverControllerKeyChange",s[s.ViewCursorOperateModeChange=6]="ViewCursorOperateModeChange",s[s.ViewCursorMove=7]="ViewCursorMove",s[s.ViewCursorStateChange=8]="ViewCursorStateChange",s))(K||{}),We=(s=>(s[s.ViewElementAdded=0]="ViewElementAdded",s[s.ViewElementRemoved=1]="ViewElementRemoved",s[s.ViewElementChanged=2]="ViewElementChanged",s))(We||{}),Dt=(s=>(s[s.ViewActiveSelectionElementAdded=0]="ViewActiveSelectionElementAdded",s[s.ViewActiveSelectionElementRemoved=1]="ViewActiveSelectionElementRemoved",s))(Dt||{});class Us{constructor(t){this.newFocusPageId=t}type=0}class Hs{constructor(t){this.camera=t}type=1}class Ys{constructor(t,e){this.objects=t,this.changeType=e}type=2}class Wt{constructor(t,e){this.objects=t,this.changeType=e}type=3}class Ws{constructor(t){this.object=t}type=4}class Xs{constructor(t){this.controllerKey=t}type=5}class js{constructor(t){this.mode=t}type=6}class Gs{constructor(t){this.selectMode=t}type=7}class Zs{constructor(t){this.state=t}type=8}function pt(s){return typeof s=="function"}const Xt=s=>{const t=typeof s;return s!==null&&t==="object"||t==="function"},Ce=s=>typeof s=="boolean",zs=s=>s instanceof F&&s.type==="RECTANGLE",Js=s=>s instanceof F&&s.type==="ELLIPSE";var jt={exports:{}},xe;function Qs(){return xe||(xe=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(h,u,p){this.fn=h,this.context=u,this.once=p||!1}function r(h,u,p,f,g){if(typeof p!="function")throw new TypeError("The listener must be a function");var w=new n(p,f||h,g),A=e?e+u:u;return h._events[A]?h._events[A].fn?h._events[A]=[h._events[A],w]:h._events[A].push(w):(h._events[A]=w,h._eventsCount++),h}function o(h,u){--h._eventsCount===0?h._events=new i:delete h._events[u]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],p,f;if(this._eventsCount===0)return u;for(f in p=this._events)t.call(p,f)&&u.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(p)):u},a.prototype.listeners=function(u){var p=e?e+u:u,f=this._events[p];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,w=f.length,A=new Array(w);g<w;g++)A[g]=f[g].fn;return A},a.prototype.listenerCount=function(u){var p=e?e+u:u,f=this._events[p];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,p,f,g,w,A){var M=e?e+u:u;if(!this._events[M])return!1;var E=this._events[M],y=arguments.length,_,c;if(E.fn){switch(E.once&&this.removeListener(u,E.fn,void 0,!0),y){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,p),!0;case 3:return E.fn.call(E.context,p,f),!0;case 4:return E.fn.call(E.context,p,f,g),!0;case 5:return E.fn.call(E.context,p,f,g,w),!0;case 6:return E.fn.call(E.context,p,f,g,w,A),!0}for(c=1,_=new Array(y-1);c<y;c++)_[c-1]=arguments[c];E.fn.apply(E.context,_)}else{var l=E.length,d;for(c=0;c<l;c++)switch(E[c].once&&this.removeListener(u,E[c].fn,void 0,!0),y){case 1:E[c].fn.call(E[c].context);break;case 2:E[c].fn.call(E[c].context,p);break;case 3:E[c].fn.call(E[c].context,p,f);break;case 4:E[c].fn.call(E[c].context,p,f,g);break;default:if(!_)for(d=1,_=new Array(y-1);d<y;d++)_[d-1]=arguments[d];E[c].fn.apply(E[c].context,_)}}return!0},a.prototype.on=function(u,p,f){return r(this,u,p,f,!1)},a.prototype.once=function(u,p,f){return r(this,u,p,f,!0)},a.prototype.removeListener=function(u,p,f,g){var w=e?e+u:u;if(!this._events[w])return this;if(!p)return o(this,w),this;var A=this._events[w];if(A.fn)A.fn===p&&(!g||A.once)&&(!f||A.context===f)&&o(this,w);else{for(var M=0,E=[],y=A.length;M<y;M++)(A[M].fn!==p||g&&!A[M].once||f&&A[M].context!==f)&&E.push(A[M]);E.length?this._events[w]=E.length===1?E[0]:E:o(this,w)}return this},a.prototype.removeAllListeners=function(u){var p;return u?(p=e?e+u:u,this._events[p]&&o(this,p)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(jt)),jt.exports}var qs=Qs();const $s=He(qs);class ti{emitter=new $s;addEventListener(t,e,i){const n=Ce(i)&&i||Xt(i)&&i.capture,r=Xt(i)&&i.once,o=pt(e)?void 0:e,a=n?`${t}capture`:t,h=pt(e)?e:e.handleEvent;return r?this.emitter.once(a,h,o):this.emitter.on(a,h,o),this}removeAllEventListeners(){this.emitter.removeAllListeners()}removeEventListener(t,e,i){const n=Ce(i)&&i||Xt(i)&&i.capture,r=pt(e)?void 0:e,o=n?`${t}capture`:t,a=pt(e)?e:e.handleEvent;return this.emitter.off(o,a,r),this}}const Xe=typeof Float32Array<"u"?Float32Array:Array,v=(s,t)=>{const e=new Xe(2);return e[0]=s,e[1]=t,e},V=(s,t)=>(t?[t[0],t[1]]=[s[0],s[1]]:t=v(s[0],s[1]),t),R=(s,t,e)=>(e=e||v(0,0),e[0]=s[0]-t[0],e[1]=s[1]-t[1],e),je=(s,t,e)=>(e=e||v(0,0),e[0]=s[0]*t[0],e[1]=s[1]*t[1],e),Z=(s,t,e)=>(e=e||v(0,0),e[0]=s[0]+t[0],e[1]=s[1]+t[1],e),Nt=(s,t,e)=>(e=e||v(0,0),e[0]=s[0]/t[0],e[1]=s[1]/t[1],e),G=(s,t)=>s[0]*t[0]+s[1]*t[1],be=(s,t)=>s[0]*t[1]-s[1]*t[0],ne=s=>Math.abs(Math.sqrt(s[0]*s[0]+s[1]*s[1])),Ge=s=>Math.abs(Math.sqrt(s[0]*s[0]+s[1]*s[1])),ei=s=>{const t=new Xe(2),e=Ge(s);return e!==0&&(t[0]=s[0]/e,t[1]=s[1]/e),t};function q(s,t){if(s)return t=t||v(0,0),t[0]=s.x,t[1]=s.y,t}class Et{x=0;y=0;width=0;height=0;constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Et(0,0,0,0)}clone(){return new Et(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}}const $=v(0,0);class Ze{minX=1/0;minY=1/0;maxX=-1/0;maxY=-1/0;constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}addPoint(t){this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxY=Math.max(this.maxY,t[1])}getRectangle(){if(this.minX>this.maxX||this.minY>this.maxY)return Et.EMPTY;const t=new Et(0,0,1,1);return t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t}merge(t){const{minX:e,minY:i,maxX:n,maxY:r}=t;$[0]=e,$[1]=i,this.addPoint($),$[0]=n,$[1]=r,this.addPoint($)}getCenter(){const t=v(0,0);return this.isEmpty()||(t[0]=(this.maxX-this.minX)/2+this.minX,t[1]=(this.maxY-this.minY)/2+this.minY),t}getHalfExtents(){return{x:(this.maxX-this.minX)/2,y:(this.maxY-this.minY)/2}}}const si=180/Math.PI;class S{a;b;c;d;tx;ty;array=null;constructor(t=1,e=0,i=0,n=1,r=0,o=0){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o}static multiply(t,e,i){const n=e.a,r=e.b,o=e.c,a=e.d,h=e.tx,u=e.ty,p=i.a,f=i.b,g=i.c,w=i.d,A=i.tx,M=i.ty;return t.a=n*p+o*f,t.b=r*p+a*f,t.c=n*g+o*w,t.d=r*g+a*w,t.tx=n*A+o*M+h,t.ty=r*A+a*M+u,t}static getScale(t){const{a:e,b:i,c:n,d:r}=t;return v(Math.sqrt(e*e+n*n),Math.sqrt(i*i+r*r))}static getTranslation(t){return v(t.tx,t.ty)}static fromMatrixOrigin=(t,e,i)=>{if(i){const n=i[0],r=i[1];t[0]=n-(e.a*n+e.c*r),t[1]=r-(e.b*n+e.d*r)}return t};static apply(t,e,i){return i=i||v(0,0),i[0]=e.a*t[0]+e.c*t[1]+e.tx,i[1]=e.b*t[0]+e.d*t[1]+e.ty,i}static getRotation(t){return Math.atan2(t.b,t.a)*si}static applyMatrixInvertToPoint(t,e,i){i=i||v(0,0);const n=1/(t.a*t.d+t.c*-t.b),[r,o]=e;return i[0]=t.d*n*r+-t.c*n*o+(t.ty*t.c-t.tx*t.d)*n,i[1]=t.a*n*o+-t.b*n*r+(-t.ty*t.a+t.tx*t.b)*n,i}static invert(t){const e=t.a,i=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty;let h=e*r-i*n;if(!h)return null;h=1/h;const u=new S;return u.a=r*h,u.b=-i*h,u.c=-n*h,u.d=e*h,u.tx=(n*a-r*o)*h,u.ty=(i*o-e*a)*h,u}set(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this}toArray(t=new Float32Array(6)){this.array||(this.array=new Float32Array(6));const e=t||this.array;return e[0]=this.a,e[1]=this.b,e[2]=this.c,e[3]=this.d,e[4]=this.tx,e[5]=this.ty,e}clone(){const t=new S;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}}function ii(s,t,e,i,n){ze(s,t,e||0,i||s.length-1,n||ni)}function ze(s,t,e,i,n){for(;i>e;){if(i-e>600){var r=i-e+1,o=t-e+1,a=Math.log(r),h=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*h*(r-h)/r)*(o-r/2<0?-1:1),p=Math.max(e,Math.floor(t-o*h/r+u)),f=Math.min(i,Math.floor(t+(r-o)*h/r+u));ze(s,t,p,f,n)}var g=s[t],w=e,A=i;for(mt(s,e,t),n(s[i],g)>0&&mt(s,e,i);w<A;){for(mt(s,w,A),w++,A--;n(s[w],g)<0;)w++;for(;n(s[A],g)>0;)A--}n(s[e],g)===0?mt(s,e,A):(A++,mt(s,A,i)),A<=t&&(e=A+1),t<=A&&(i=A-1)}}function mt(s,t,e){var i=s[t];s[t]=s[e],s[e]=i}function ni(s,t){return s<t?-1:s>t?1:0}class ri{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Mt(t,e))return i;const n=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],h=e.leaf?n(a):a;Mt(t,h)&&(e.leaf?i.push(a):Zt(t,h)?this._all(a,i):r.push(a))}e=r.pop()}return i}collides(t){let e=this.data;if(!Mt(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const r=e.children[n],o=e.leaf?this.toBBox(r):r;if(Mt(t,o)){if(e.leaf||Zt(t,o))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=nt([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),r=[],o=[];let a,h,u;for(;i||r.length;){if(i||(i=r.pop(),h=r[r.length-1],a=o.pop(),u=!0),i.leaf){const p=oi(t,i.children,e);if(p!==-1)return i.children.splice(p,1),r.push(i),this._condense(r),this}!u&&!i.leaf&&Zt(i,n)?(r.push(i),o.push(a),a=0,h=i,i=i.children[0]):h?(a++,i=h.children[a],u=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const r=i-e+1;let o=this._maxEntries,a;if(r<=o)return a=nt(t.slice(e,i+1)),tt(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=nt([]),a.leaf=!1,a.height=n;const h=Math.ceil(r/o),u=h*Math.ceil(Math.sqrt(o));Te(t,e,i,u,this.compareMinX);for(let p=e;p<=i;p+=u){const f=Math.min(p+u-1,i);Te(t,p,f,h,this.compareMinY);for(let g=p;g<=f;g+=h){const w=Math.min(g+h-1,f);a.children.push(this._build(t,g,w,n-1))}}return tt(a,this.toBBox),a}_chooseSubtree(t,e,i,n){for(;n.push(e),!(e.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let h=0;h<e.children.length;h++){const u=e.children[h],p=Gt(u),f=hi(t,u)-p;f<o?(o=f,r=p<r?p:r,a=u):f===o&&p<r&&(r=p,a=u)}e=a||e.children[0]}return e}_insert(t,e,i){const n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),ft(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)}_split(t,e){const i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=nt(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,tt(i,this.toBBox),tt(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=nt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,tt(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,r=1/0,o=1/0;for(let a=e;a<=i-e;a++){const h=_t(t,0,a,this.toBBox),u=_t(t,a,i,this.toBBox),p=li(h,u),f=Gt(h)+Gt(u);p<r?(r=p,n=a,o=f<o?f:o):p===r&&f<o&&(o=f,n=a)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:ai,r=t.leaf?this.compareMinY:ci,o=this._allDistMargin(t,e,i,n),a=this._allDistMargin(t,e,i,r);o<a&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const r=this.toBBox,o=_t(t,0,e,r),a=_t(t,i-e,i,r);let h=vt(o)+vt(a);for(let u=e;u<i-e;u++){const p=t.children[u];ft(o,t.leaf?r(p):p),h+=vt(o)}for(let u=i-e-1;u>=e;u--){const p=t.children[u];ft(a,t.leaf?r(p):p),h+=vt(a)}return h}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)ft(e[n],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():tt(t[e],this.toBBox)}}function oi(s,t,e){if(!e)return t.indexOf(s);for(let i=0;i<t.length;i++)if(e(s,t[i]))return i;return-1}function tt(s,t){_t(s,0,s.children.length,t,s)}function _t(s,t,e,i,n){n||(n=nt(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=t;r<e;r++){const o=s.children[r];ft(n,s.leaf?i(o):o)}return n}function ft(s,t){return s.minX=Math.min(s.minX,t.minX),s.minY=Math.min(s.minY,t.minY),s.maxX=Math.max(s.maxX,t.maxX),s.maxY=Math.max(s.maxY,t.maxY),s}function ai(s,t){return s.minX-t.minX}function ci(s,t){return s.minY-t.minY}function Gt(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function vt(s){return s.maxX-s.minX+(s.maxY-s.minY)}function hi(s,t){return(Math.max(t.maxX,s.maxX)-Math.min(t.minX,s.minX))*(Math.max(t.maxY,s.maxY)-Math.min(t.minY,s.minY))}function li(s,t){const e=Math.max(s.minX,t.minX),i=Math.max(s.minY,t.minY),n=Math.min(s.maxX,t.maxX),r=Math.min(s.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,r-i)}function Zt(s,t){return s.minX<=t.minX&&s.minY<=t.minY&&t.maxX<=s.maxX&&t.maxY<=s.maxY}function Mt(s,t){return t.minX<=s.maxX&&t.minY<=s.maxY&&t.maxX>=s.minX&&t.maxY>=s.minY}function nt(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Te(s,t,e,i,n){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;ii(s,o,t,e,n),r.push(t,o,o,e)}}const re=new ri(16),L=v(0,0),et=v(0,0);class F extends ti{static INACTIVE=!1;type;_elementData;parentNode=null;_bounds=new Ze;_boundDirty=!0;_inactive=!1;_rBushNode={displayObject:this};_OBBPoints=[v(0,0),v(0,0),v(0,0),v(0,0)];constructor(t){super(),this.type=t.type,this._elementData=t}static resize(t,e){if(!e)return null;const{width:i,height:n}=e,{width:r,height:o}=t;let a=!1;return!Number.isNaN(Number(i))&&i!==r&&(a=!0),!Number.isNaN(Number(n))&&n!==o&&(a=!0),a?[{guid:t.getGuidKey(),size:{x:i||r,y:n||o}}]:null}get id(){return JSON.stringify(this._elementData.guid)}getFills(){return this._elementData.fillPaints??[]}get zIndex(){return this._elementData.parentIndex.position}get width(){return this._elementData.size.x}get height(){return this._elementData.size.y}get x(){return this.transform.tx}get y(){return this.transform.ty}get visible(){return this._elementData.visible}get transform(){return this._elementData.transform}get OBB(){const{x:t,y:e,width:i,height:n,transform:r}=this;return{x:t,y:e,width:i,height:n,transform:r}}get name(){return this._elementData.name}getBorder(){return null}getGuidKey(){const{guid:t}=this._elementData;return t}inactive(){return this._inactive}_updateBounds(){this._bounds.clear();const t=this.transform,e=t.tx,i=t.ty,[n,r]=S.fromMatrixOrigin([0,0],t,[this.x,this.y]),o=new S(t.a,t.b,t.c,t.d,t.tx,t.ty);o.tx=n,o.ty=r,L[0]=e,L[1]=i,V(L,this._OBBPoints[0]),L[0]=e+this.width,S.apply(L,o,et),V(et,this._OBBPoints[1]),L[0]=e+this.width,L[1]=i+this.height,S.apply(L,o,et),V(et,this._OBBPoints[2]),L[0]=e,L[1]=i+this.height,S.apply(L,o,et),V(et,this._OBBPoints[3]),this._OBBPoints.forEach(this._bounds.addPoint,this._bounds),this._boundDirty=!1}_updateRBush(){if(Object.getPrototypeOf(this).constructor.INACTIVE||this.inactive())return;re.remove(this._rBushNode);const{minX:t,minY:e,maxX:i,maxY:n}=this._bounds;this._rBushNode.minX=t,this._rBushNode.minY=e,this._rBushNode.maxX=i,this._rBushNode.maxY=n,re.load([this._rBushNode])}getBounds(){return this._boundDirty&&(this._updateBounds(),this._updateRBush()),this._bounds}getOBBPoints(){return this._OBBPoints}getBoundingClientRect(){return this.getBounds().getRectangle()}setElementData(t){Object.is(this._elementData.transform,t.transform)||(this._boundDirty=!0),this._elementData=t,this.getBounds()}getElementById(t){return t===this.id?this:void 0}resize(t){return F.resize(this,t)}getCenter(){return this._bounds.getCenter()}getHalfExtents(){return this._bounds.getHalfExtents()}appendChild(){}removeChild(t){}}class Rt extends F{static TYPE=O.RECTANGLE;getBorder(){const{cornerRadius:t}=this._elementData;return t==="MIXED"?[this._elementData.topLeftRadius,this._elementData.topRightRadius,this._elementData.bottomLeftRadius,this._elementData.bottomRightRadius]:t}}class ui extends F{static TYPE=O.ELLIPSE}const rt=100,Je=32,mi=(s,t)=>{const e=Math.max(s.length,t.length);for(let i=0;i<e;i++){if(!s[i])return!1;if(!t[i])return!0;if(s[i]===t[i])continue;const n=s.charCodeAt(i),r=t.charCodeAt(i);return n>=r}return!1};function oe(s){return s.split("").map(t=>t.codePointAt(0)-Je)}function di(s){return s.map(t=>String.fromCodePoint(t+Je)).join("")}function Qe(s,t=1){const e=Array.isArray(s)?s:oe(s);let i=t;for(let n=e.length-1;n>=0;n--){const r=e[n]||0;i+r>rt?(e[n]=i+r-rt,i=1):(e[n]=i+r,i=0)}return e[0]>rt&&(e[0]-=rt,e.unshift(1)),di(e)}const pi=(s,t)=>{const e=Math.max(s.length,t.length);let i=0;const n=[];for(let r=e-1;r>=0;r--){let o=(s[r]||0)+i;const a=t[r]||0;i=0,o<a&&o[r-1]&&(o+=rt,i-=1),n.unshift(o-a)}return n.reduce((r,o)=>r*rt+o,0)};function _i(s,t){const e=Array.isArray(s)?s:oe(s),i=Array.isArray(t)?t:oe(t),n=pi(e,i),r=new Array(Math.max(e.length,i.length)).fill(0),o=n<0?e:i;return r.splice(0,o.length,...o),Qe([...r],Math.floor(Math.abs(n)/2))}const fi=(s,t)=>{if(s)return t?_i(s,t):Qe(s)};class ct extends F{_children=[];getBounds(){return this._children.forEach(t=>{if(!t.visible)return;const e=t.getBounds();this._bounds.merge(e)}),this._bounds}getChildren(){return this._children}getElementById(t){const e=super.getElementById(t);if(e)return e;const i=this._children;let n;return i.some(r=>(n=r.getElementById(t),n)),n}getElementByTagName(t){const e=[];return this._children.forEach(i=>{i.type===t&&e.push(i),i instanceof ct&&e.push(...i.getElementByTagName(t))}),e}_appendChild(t){const e=this._children.length;let i=0,n=!1;for(;i<e&&!n;){const o=this._children[i].zIndex,a=t.zIndex;mi(o,a)?n=!0:i++}this._children.splice(i,0,t),t.parentNode?.removeChild(t),t.parentNode=this}appendChild(...t){t.forEach(e=>{this._appendChild(e)},this)}removeChild(t){let e;return this._children=this._children?.filter(i=>{const n=!Object.is(i,t);return n||(i.parentNode=null,e=i,!1)}),e}render(){const{size:t,transform:e}=this._elementData,{a:i,b:n,c:r,d:o,tx:a,ty:h}=e,{x:u,y:p}=t;return{type:"frame",x:a,y:h,width:u,height:p,transform:[i,n,r,o,0,0],fills:this.getFills()}}getFirst(){return this._children[0]}getLast(){return this._children[this._children.length-1]}}class ue extends ct{_visibleElements;getVisibleElementRenderObjects(){return this._visibleElements||(this._visibleElements=this._children.filter(t=>t.visible)),this._visibleElements}setVisibleArea(t){const{x:e,y:i,width:n,height:r}=t;this._visibleElements=this._children.filter(o=>{if(!o.visible)return!1;const a=o.getBoundingClientRect(),{x:h,y:u,width:p,height:f}=a,g=h<e+n&&h+p>e,w=u<i+r&&u+f>i;return g&&w})}}class yi extends ct{}class wt extends ct{}const zt=s=>{const{type:t}=s;let e=Rt;switch(t){case O.RECTANGLE:e=Rt;break;case O.ELLIPSE:e=ui;break;case O.PAGE:e=ue;break;case O.FRAME:e=yi;break;case O.DOCUMENT:e=wt;break;default:e=Rt}return new e(s)};class gi{_document;constructor(t){this._initElements(t)}_initElements(t){const e={},i=new Map;t.forEach(n=>{const r=zt(n);if(i.set(r.id,r),r instanceof wt){this._document=r;return}const{parentIndex:o}=n,{guid:a}=o,h=JSON.stringify(a);(e[h]||(e[h]=[])).push(r)}),Object.entries(e).forEach(([n,r])=>{const o=i.get(n);o&&o.appendChild(...r)}),i.clear()}getElementById(t){return t===this._document.id?this._document:this._document.getElementById(t)}get document(){return this._document}createElementByName(t){let e;return t===O.RECTANGLE&&(e=Ye({left:0,top:0})),zt(e)}createElementByData(t){return zt(t)}}function Ei(s,t,e,i){const n=s-e,r=t-i;return Math.sqrt(n*n+r*r)}function Lt(s,t,e,i,n,r){return n>=s&&n<=s+e&&r>=t&&r<=t+i}function St(s,t,e,i,n,r){const o=(Math.atan2(r-t,n-s)+Math.PI*2)%(Math.PI*2),a={x:s+e*Math.cos(o),y:t+e*Math.sin(o)};return Ei(a.x,a.y,n,r)<=i/2}function Ai(s,t,e,i){return s/(e*e)+t/(i*i)}function wi(s,t,e,i,n,r){const o=s-e,a=t-i,h=n-e,u=r-i,p=o*h+a*u,f=h*h+u*u;let g=-1;f!==0&&(g=p/f);let w,A;g<0?(w=e,A=i):g>1?(w=n,A=r):(w=e+g*h,A=i+g*u);const M=s-w,E=t-A;return Math.sqrt(M*M+E*E)}function z(s,t,e,i,n,r,o){const a=Math.min(s,e),h=Math.max(s,e),u=Math.min(t,i),p=Math.max(t,i),f=n/2;return r>=a-f&&r<=h+f&&o>=u-f&&o<=p+f?wi(r,o,s,t,e,i)<=n/2:!1}function vi(s,t,e,i,n,r,o,a){const[h,u,p,f]=n;return z(s+h,t,s+e-u,t,r,o,a)||z(s+e,t+u,s+e,t+i-p,r,o,a)||z(s+e-p,t+i,s+f,t+i,r,o,a)||z(s,t+i-f,s,t+h,r,o,a)||St(s+e-u,t+u,u,r,o,a)||St(s+e-p,t+i-p,p,0,o,a)||St(s+f,t+i-f,f,r,o,a)||St(s+h,t+h,h,r,o,a)}class Mi{constructor(t,e,i){this._getVisibleElementRenderObjects=t,this._activeSelection=e,this._root=i,this.pick=this.pick.bind(this)}_isPointInEllipse=(t,e)=>{const{width:i,height:n}=e.OBB,[r,o]=t,a=i/2,h=n/2,u=(r-a)*(r-a),p=(o-h)*(o-h);return Ai(u,p,a,h)<=1};_isPointInRect=(t,e)=>{const{width:i,height:n}=e.OBB;if(!e.getFills())return!1;const o=e.getBorder(),a=Array.isArray(o)?o:[o,o,o,o];return a.some(u=>!!u)?vi(0,0,i,n,a,0,t[0],t[1]):Lt(0,0,i,n,t[0],t[1])};pick(t){let e=this._root;return(this._getVisibleElementRenderObjects().slice().reverse()||[]).some(n=>{const r=S.applyMatrixInvertToPoint(n.transform,t);return zs(n)&&this._isPointInRect(r,n)||Js(n)&&this._isPointInEllipse(r,n)?(e=n,!0):!1}),e}pickActiveSelection(t){return this._activeSelection.hitTest(t)}disabled(){}}const Si="#f5f5f5",Ct=20,qe={editor:{}};function Vt(s,t){qe.editor[s]=t}const Jt={a:1,b:0,c:0,d:1,tx:0,ty:0};var T=(s=>(s[s.NONE=1]="NONE",s[s.BLANK=2]="BLANK",s[s.SELECTION_CONTEXT=4]="SELECTION_CONTEXT",s[s.SELECT_ROTATE_LEFT_TOP=8]="SELECT_ROTATE_LEFT_TOP",s[s.SELECT_ROTATE_RIGHT_TOP=16]="SELECT_ROTATE_RIGHT_TOP",s[s.SELECT_ROTATE_LEFT_BOTTOM=32]="SELECT_ROTATE_LEFT_BOTTOM",s[s.SELECT_ROTATE_RIGHT_BOTTOM=64]="SELECT_ROTATE_RIGHT_BOTTOM",s[s.SELECT_RESIZE_LEFT=128]="SELECT_RESIZE_LEFT",s[s.SELECT_RESIZE_TOP=256]="SELECT_RESIZE_TOP",s[s.SELECT_RESIZE_RIGHT=512]="SELECT_RESIZE_RIGHT",s[s.SELECT_RESIZE_BOTTOM=1024]="SELECT_RESIZE_BOTTOM",s[s.SELECT_RESIZE_LEFT_TOP=2048]="SELECT_RESIZE_LEFT_TOP",s[s.SELECT_RESIZE_RIGHT_TOP=4096]="SELECT_RESIZE_RIGHT_TOP",s[s.SELECT_RESIZE_RIGHT_BOTTOM=8192]="SELECT_RESIZE_RIGHT_BOTTOM",s[s.SELECT_RESIZE_LEFT_BOTTOM=16384]="SELECT_RESIZE_LEFT_BOTTOM",s))(T||{});const Ci=120,$e=s=>!!(Ci&s),xi=18560,bi=6400,Ti=12800,Ii=25600,Oi=s=>!!(xi&s),Di=s=>!!(bi&s),Ri=s=>!!(Ti&s),Pi=s=>!!(Ii&s),Bi=32640,ts=s=>!!(Bi&s);class x{constructor(t,e,i,n){this._resizeControllerType=t,this._rotateControllerType=e,this._getCenter=i,this._coefficients=n}static _DEFAULT_RESIZE_WIDTH=6;static _DEFAULT_RESIZE_HEIGHT=6;static _DEFAULT_ROTATE_WIDTH=30;static _DEFAULT_ROTATE_HEIGHT=30;static _RESIZE_WIDTH=x._DEFAULT_RESIZE_WIDTH;static _RESIZE_HEIGHT=x._DEFAULT_RESIZE_HEIGHT;static _ROTATE_WIDTH=x._DEFAULT_ROTATE_WIDTH;static _ROTATE_HEIGHT=x._DEFAULT_ROTATE_HEIGHT;static _SCALE=1;static setScale(t){x._SCALE=t,x._RESIZE_WIDTH=x._DEFAULT_RESIZE_WIDTH*x._SCALE,x._RESIZE_HEIGHT=x._DEFAULT_RESIZE_HEIGHT*x._SCALE,x._ROTATE_WIDTH=x._DEFAULT_ROTATE_WIDTH*x._SCALE,x._ROTATE_HEIGHT=x._DEFAULT_ROTATE_HEIGHT*x._SCALE}get x(){return this._getCenter()[0]-x._RESIZE_WIDTH/2}get y(){return this._getCenter()[1]-x._RESIZE_HEIGHT/2}get width(){return x._RESIZE_WIDTH}get height(){return x._RESIZE_HEIGHT}_getRotateCenter(){const[t,e]=this._getCenter(),{_RESIZE_WIDTH:i,_RESIZE_HEIGHT:n,_ROTATE_WIDTH:r,_ROTATE_HEIGHT:o}=x,a=r/2-i/2,h=o/2-n/2;return{x:t+a*this._coefficients.x,y:e+h*this._coefficients.y}}_hitTestResize(t){const[e,i]=this._getCenter(),{_RESIZE_WIDTH:n,_RESIZE_HEIGHT:r}=x,o=e-n/2,a=i-r/2;return Lt(o,a,n,r,t[0],t[1])}_hitTestRotate(t){const{x:e,y:i}=this._getRotateCenter(),{_ROTATE_WIDTH:n,_ROTATE_HEIGHT:r}=x,o=e-n/2,a=i-r/2;return Lt(o,a,n,r,t[0],t[1])}hitTest(t){return this._hitTestResize(t)?this._resizeControllerType:this._hitTestRotate(t)?this._rotateControllerType:null}}class Ni{constructor(t){this._activeSelection=t,this._createCorner()}_corners=[];getCorners(){return this._corners}_createCorner(){this._corners.push(new x(2048,8,this._leftTopCornerCenter,{x:-1,y:-1})),this._corners.push(new x(4096,16,this._rightTopCornerCenter,{x:1,y:-1})),this._corners.push(new x(16384,32,this._leftBottomCornerCenter,{x:-1,y:1})),this._corners.push(new x(8192,64,this._rightBottomCornerCenter,{x:1,y:1}))}_leftTopCornerCenter=()=>v(0,0);_rightTopCornerCenter=()=>{const{OBB:t}=this._activeSelection;return v(t.width,0)};_leftBottomCornerCenter=()=>{const{OBB:t}=this._activeSelection;return v(0,t.height)};_rightBottomCornerCenter=()=>{const{OBB:t}=this._activeSelection;return v(t.width,t.height)};hitTest(t){let e=null;return this._corners.some(i=>(e=i.hitTest(t),!!e)),e}}class Li extends Rt{_onActiveSelectionChange=new D;onActiveSelectionChange=this._onActiveSelectionChange.event;static INACTIVE=!0;__objects=[];_OBBDirty=!1;_cornerCollection;controllerType;constructor(){super({type:O.RECTANGLE,size:{x:0,y:0},fillPaints:[{type:"SOLID"}],transform:{a:1,b:0,c:0,d:1,tx:0,ty:0}}),this.controllerType=4,this._cornerCollection=new Ni(this),Vt("onDidSelectionChange",this.onActiveSelectionChange)}get _objects(){return this.__objects}set _objects(t){this.__objects=t,this._onActiveSelectionChange.fire(this)}addSelectElement=t=>{t&&(this._objects=this._objects.concat(t),this._OBBDirty=!0)};removeSelectElement(t){t&&(this._objects=this._objects.filter(e=>e!==t),this._OBBDirty=!0,this._objects.length||this.clear())}clear(){this._objects=[],this._OBBDirty=!1,this._bounds.clear()}updateOBB(){const{_objects:t}=this;this._bounds.clear(),t.forEach(i=>{if(!i.visible)return;const n=i.getBounds();this._bounds.merge(n)});const e=this._bounds.getRectangle();Jt.tx=e.x,Jt.ty=e.y,this._elementData.transform={...Jt},this._elementData.size={x:e.width,y:e.height},this._OBBDirty=!1}get OBB(){return this._objects.length===1?this._objects[0].OBB:(this._OBBDirty&&this.updateOBB(),super.OBB)}getBounds(){return this._objects.length===1?this._objects[0].getBounds():(super.getBounds(),this._bounds)}hasActive(){return!!this._objects.length}hasSelected=t=>this._objects.includes(t);getCorners(){return this._cornerCollection.getCorners()}_hitContext(t){const{width:e,height:i}=this.OBB;return Lt(0,0,e,i,t[0],t[1])?4:1}_hitBorder(t){const{width:e,height:i}=this.OBB;return z(0,0,e,0,Ct,t[0],t[1])?256:z(0,0,0,i,Ct,t[0],t[1])?128:z(0,i,e,i,Ct,t[0],t[1])?1024:z(e,0,e,i,Ct,t[0],t[1])?512:null}_hitCorner(t){return this._cornerCollection.hitTest(t)}hitTest(t){const{transform:e}=this.OBB,i=S.applyMatrixInvertToPoint(e,t);let n=null;return n=n||(this.hasActive()?null:1),n=n||this._hitCorner(i),n=n||this._hitBorder(i),n=n||this._hitContext(i),n||2}getObjects(){return this._objects}isActive(){return this._objects.length>0}inactive(){return!0}getFills(){const t=[];return this._objects.forEach(e=>{t.push(...e.getFills())}),t}getOBBPoints(){return this._objects.length===1?this._objects[0].getOBBPoints():super.getOBBPoints()}}const yt=10,Vi=(s,t,e,i)=>{let n=t;const r=s[t];for(let o=t+1;o<=e;o++)i(s[o],r)&&(n++,[s[o],s[n]]=[s[n],s[o]]);return[s[t],s[n]]=[s[n],s[t]],n};function Ft(s,t,e=0,i=s.length-1){if(e>=i)return;const n=Vi(s,e,i,t);return Ft(s,t,e,n-1),Ft(s,t,n+1,i),s}function Fi(s,t,e,i){let n,r=yt;for(let o=0;o<s.length;o++){const a=e(s[o]),h=Math.sign(i);h===1&&a<t||h===-1&&a>t||Math.abs(t-a)<r&&(n=s[o],r=Math.abs(t-a))}return n}class ki{_xAxisArr=[];_yAxisArr=[];_centerMap=new Map;_hasCache=!1;_xMap=new Map;_yMap=new Map;_getOtherCenter(t){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=t[t.length-1];for(const u of t)e=Math.min(e,u[0]),i=Math.max(i,u[0]),n=Math.min(n,u[1]),r=Math.max(r,u[1]);const[a,h]=o;return[[e,h],[i,h],[a,n],[a,r]]}_buildMap(t){for(const e of t)for(const i of e.concat(this._getOtherCenter(e))){const[n,r]=i,o=this._xMap.get(n);o?o.push(r):this._xMap.set(n,[n,r]);const a=this._yMap.get(r);a?a.unshift(n):this._yMap.set(r,[n,r])}}_reBuildHashMap(){this._xAxisArr=Array.from(this._xMap.values()),this._yAxisArr=Array.from(this._yMap.values())}buildCache(t){this._hasCache||(this._xMap.clear(),this._yMap.clear(),this._buildMap(t),this._reBuildHashMap(),this._sortData(),this._hasCache=!0)}clearCache(){this._hasCache=!1,this._xAxisArr=[],this._yAxisArr=[],this._centerMap.clear(),this._xMap.clear(),this._yMap.clear()}_sortData(){this._xAxisArr=Ft(this._xAxisArr,(t,e)=>t[0]<e[0]),this._yAxisArr=Ft(this._yAxisArr,(t,e)=>t[t.length-1]<e[e.length-1])}getSortedData(){return{x:this._xAxisArr,y:this._yAxisArr}}}class Ki{_cacheMap;_getClosedVec(t,e,i,n){return Fi(t,e,n,i)}resolve(t,e,i){this._cacheMap=t;const{x:n,y:r}=this._cacheMap.getSortedData(),o=this._getClosedVec(n,e[0],i[0],h=>h[0]),a=this._getClosedVec(r,e[1],i[1],h=>h[h.length-1]);return{x:o,y:a}}}class Ui{constructor(t){this._cursor=t}_cacheMap=new ki;_adsorptionPointsResolver=new Ki;_afterAbsorbMovement=v(0,0);_tryOnePointAbsorption=(t,e)=>{const{x:i,y:n}=this._adsorptionPointsResolver.resolve(this._cacheMap,t,e);let r=[],o=[],a=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY;if(i?.length){const u=Math.abs(i[0]-t[0]);Math.abs(a)>=u&&(a=i[0]-t[0],r=[...i,t[1]])}if(n?.length){const u=Math.abs(n[n.length-1]-t[1]);Math.abs(h)>=u&&(h=n[n.length-1]-t[1],o=[t[0],...n])}return{x:r,y:o,diff:v(a,h)}};_getCloseInfo(t){let[e,i]=v(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);const n={x:[],y:[],diff:[e,i]};for(const r of t)e>=r.diff[0]&&([e,n.x]=[r.diff[0],r.x]),i>=r.diff[1]&&([i,n.y]=[r.diff[1],r.y]);return n.x.length||(e=0),n.y.length||(i=0),{...n,diff:[e,i]}}_cacheAbsorbPoints={x:new Set,y:new Set};_preAbsorbPoints=v(Number.NaN,Number.NaN);_curAbsorbPoints=v(0,0);_absorbStatus={x:!1,y:!1};_accumulator=v(0,0);_addMovementToAccumulator(t){this._absorbStatus.x?this._accumulator[0]+=t[0]:this._accumulator[0]=0,this._absorbStatus.y?this._accumulator[1]+=t[1]:this._accumulator[1]=0}_checkAbsorbStatus(t){t.x.length>0?this._absorbStatus.x=!0:this._absorbStatus.x=!1,t.y.length>0?this._absorbStatus.y=!0:this._absorbStatus.y=!1}_comparePreAndCurX(t){this._absorbStatus.x&&(this._preAbsorbPoints[0]!==this._curAbsorbPoints[0]?([this._preAbsorbPoints[0]]=this._curAbsorbPoints,this._accumulator[0]=0,this._afterAbsorbMovement[0]=t):Math.abs(this._accumulator[0])>=yt?(this._afterAbsorbMovement[0]=yt*Math.sign(this._afterAbsorbMovement[0]),this._preAbsorbPoints[0]=Number.NaN):this._afterAbsorbMovement[0]=0)}_comparePreAndCurY(t){this._absorbStatus.y&&(this._preAbsorbPoints[1]!==this._curAbsorbPoints[1]?([,this._preAbsorbPoints[1]]=this._curAbsorbPoints,this._accumulator[1]=0,this._afterAbsorbMovement[1]=t):Math.abs(this._accumulator[1])>=yt?(this._afterAbsorbMovement[1]=yt*Math.sign(this._afterAbsorbMovement[1]),this._preAbsorbPoints[1]=Number.NaN):this._afterAbsorbMovement[1]=0)}_comparePreAndCurPoint(t){this._comparePreAndCurX(t[0]),this._comparePreAndCurY(t[1])}_onElementWillMove(t,e,i){this._cacheMap.buildCache(t);const n=e.map((u,p)=>({...this._tryOnePointAbsorption(u,i),index:p})),{diff:r,x:o,y:a}=this._getCloseInfo(n);[this._curAbsorbPoints[0]]=o,this._curAbsorbPoints[1]=a[a.length-1];const h={x:o,y:a};return this._checkAbsorbStatus(h),this._comparePreAndCurPoint(r),this._cursor.setState({adsorptionPoints:h}),this._afterAbsorbMovement}onElementWillMove(t,e,i){return this._addMovementToAccumulator(i),V(i,this._afterAbsorbMovement),this._onElementWillMove(t,e,i)}_clearCachePoints(){this._cacheAbsorbPoints.x.clear(),this._cacheAbsorbPoints.y.clear()}onElementMoveEnd(t){this._cacheMap.clearCache(),this._clearCachePoints(),this._cursor.setState({adsorptionPoints:{x:[],y:[]}})}onElementDidMove(t){}}class Hi{_onCursorStateChange=new D;onCursorStateChange=this._onCursorStateChange.event;_state={adsorptionPoints:{x:[],y:[]},hoverObject:null,hoverControllerKey:T.BLANK,mode:1,createType:O.RECTANGLE};get state(){return this._state}setState(t){this._state={...this._state,...t},this._onCursorStateChange.fire(this._state)}}var N=(s=>(s[s.ReadOnly=0]="ReadOnly",s[s.Edit=1]="Edit",s[s.CreateNormalShape=2]="CreateNormalShape",s))(N||{});v(0,0);class Yi{_hoverControllerKey;_hoverObject;_mode=1;_createType=O.RECTANGLE;_selectBounds=new Ze;_adsorptionResolver=new Ui(this);_onDidCursorOperateModeChange=new D;onDidCursorOperateModeChange=this._onDidCursorOperateModeChange.event;_isXAdsorbing=!1;_isYAdsorbing=!1;_stateAccessor=new Hi;onCursorStateChange=this._stateAccessor.onCursorStateChange;constructor(){Vt("onDidOperateModeChange",this.onDidCursorOperateModeChange)}_listenCursorStateChange=t=>{};setState(t){this._stateAccessor.setState(t)}setHoverObject(t,e){Object.is(this._hoverObject,t)||(this._hoverObject=t,e.emitViewEvent(new Ws(t)))}getHoverObject(){return this._hoverObject}setControllerTarget(t,e){this._hoverControllerKey!==t&&(this._hoverControllerKey=t,e.emitViewEvent(new Xs(t)))}getControllerKey(){return this._hoverControllerKey}getOperateMode(){return this._mode}setOperateMode(t,e){if(!Object.values(N).includes(t))return console.error(`'${t}' is does not exist on type 'OperateMode' `);this._mode!==t&&(this._mode=t,e.emitViewEvent(new js(t)),this._onDidCursorOperateModeChange.fire(t))}getCreateNormalElementType(){return this._createType}getBoxSelectBounds(){return this._selectBounds}setBoxSelectBounds(t,e){this._selectBounds.clear(),e?.forEach(this._selectBounds.addPoint.bind(this._selectBounds)),t.emitViewEvent(new Gs(!0))}onElementDidMove=t=>this._adsorptionResolver.onElementDidMove(t);onElementMoveEnd=t=>this._adsorptionResolver.onElementMoveEnd(t);onElementWillMove(t,e,i){return this._adsorptionResolver.onElementWillMove(t,e,i)}}var C=(s=>(s[s.DependsOnKbLayout=-1]="DependsOnKbLayout",s[s.Unknown=0]="Unknown",s[s.Backspace=1]="Backspace",s[s.Tab=2]="Tab",s[s.Enter=3]="Enter",s[s.Shift=4]="Shift",s[s.Ctrl=5]="Ctrl",s[s.Alt=6]="Alt",s[s.PauseBreak=7]="PauseBreak",s[s.CapsLock=8]="CapsLock",s[s.Escape=9]="Escape",s[s.Space=10]="Space",s[s.PageUp=11]="PageUp",s[s.PageDown=12]="PageDown",s[s.End=13]="End",s[s.Home=14]="Home",s[s.LeftArrow=15]="LeftArrow",s[s.UpArrow=16]="UpArrow",s[s.RightArrow=17]="RightArrow",s[s.DownArrow=18]="DownArrow",s[s.Insert=19]="Insert",s[s.Delete=20]="Delete",s[s.Digit0=21]="Digit0",s[s.Digit1=22]="Digit1",s[s.Digit2=23]="Digit2",s[s.Digit3=24]="Digit3",s[s.Digit4=25]="Digit4",s[s.Digit5=26]="Digit5",s[s.Digit6=27]="Digit6",s[s.Digit7=28]="Digit7",s[s.Digit8=29]="Digit8",s[s.Digit9=30]="Digit9",s[s.KeyA=31]="KeyA",s[s.KeyB=32]="KeyB",s[s.KeyC=33]="KeyC",s[s.KeyD=34]="KeyD",s[s.KeyE=35]="KeyE",s[s.KeyF=36]="KeyF",s[s.KeyG=37]="KeyG",s[s.KeyH=38]="KeyH",s[s.KeyI=39]="KeyI",s[s.KeyJ=40]="KeyJ",s[s.KeyK=41]="KeyK",s[s.KeyL=42]="KeyL",s[s.KeyM=43]="KeyM",s[s.KeyN=44]="KeyN",s[s.KeyO=45]="KeyO",s[s.KeyP=46]="KeyP",s[s.KeyQ=47]="KeyQ",s[s.KeyR=48]="KeyR",s[s.KeyS=49]="KeyS",s[s.KeyT=50]="KeyT",s[s.KeyU=51]="KeyU",s[s.KeyV=52]="KeyV",s[s.KeyW=53]="KeyW",s[s.KeyX=54]="KeyX",s[s.KeyY=55]="KeyY",s[s.KeyZ=56]="KeyZ",s[s.Meta=57]="Meta",s[s.ContextMenu=58]="ContextMenu",s[s.F1=59]="F1",s[s.F2=60]="F2",s[s.F3=61]="F3",s[s.F4=62]="F4",s[s.F5=63]="F5",s[s.F6=64]="F6",s[s.F7=65]="F7",s[s.F8=66]="F8",s[s.F9=67]="F9",s[s.F10=68]="F10",s[s.F11=69]="F11",s[s.F12=70]="F12",s[s.F13=71]="F13",s[s.F14=72]="F14",s[s.F15=73]="F15",s[s.F16=74]="F16",s[s.F17=75]="F17",s[s.F18=76]="F18",s[s.F19=77]="F19",s[s.F20=78]="F20",s[s.F21=79]="F21",s[s.F22=80]="F22",s[s.F23=81]="F23",s[s.F24=82]="F24",s[s.NumLock=83]="NumLock",s[s.ScrollLock=84]="ScrollLock",s[s.Semicolon=85]="Semicolon",s[s.Equal=86]="Equal",s[s.Comma=87]="Comma",s[s.Minus=88]="Minus",s[s.Period=89]="Period",s[s.Slash=90]="Slash",s[s.Backquote=91]="Backquote",s[s.BracketLeft=92]="BracketLeft",s[s.Backslash=93]="Backslash",s[s.BracketRight=94]="BracketRight",s[s.Quote=95]="Quote",s[s.OEM_8=96]="OEM_8",s[s.IntlBackslash=97]="IntlBackslash",s[s.Numpad0=98]="Numpad0",s[s.Numpad1=99]="Numpad1",s[s.Numpad2=100]="Numpad2",s[s.Numpad3=101]="Numpad3",s[s.Numpad4=102]="Numpad4",s[s.Numpad5=103]="Numpad5",s[s.Numpad6=104]="Numpad6",s[s.Numpad7=105]="Numpad7",s[s.Numpad8=106]="Numpad8",s[s.Numpad9=107]="Numpad9",s[s.NumpadMultiply=108]="NumpadMultiply",s[s.NumpadAdd=109]="NumpadAdd",s[s.NUMPAD_SEPARATOR=110]="NUMPAD_SEPARATOR",s[s.NumpadSubtract=111]="NumpadSubtract",s[s.NumpadDecimal=112]="NumpadDecimal",s[s.NumpadDivide=113]="NumpadDivide",s[s.KEY_IN_COMPOSITION=114]="KEY_IN_COMPOSITION",s[s.ABNT_C1=115]="ABNT_C1",s[s.ABNT_C2=116]="ABNT_C2",s[s.AudioVolumeMute=117]="AudioVolumeMute",s[s.AudioVolumeUp=118]="AudioVolumeUp",s[s.AudioVolumeDown=119]="AudioVolumeDown",s[s.BrowserSearch=120]="BrowserSearch",s[s.BrowserHome=121]="BrowserHome",s[s.BrowserBack=122]="BrowserBack",s[s.BrowserForward=123]="BrowserForward",s[s.MediaTrackNext=124]="MediaTrackNext",s[s.MediaTrackPrevious=125]="MediaTrackPrevious",s[s.MediaStop=126]="MediaStop",s[s.MediaPlayPause=127]="MediaPlayPause",s[s.LaunchMediaPlayer=128]="LaunchMediaPlayer",s[s.LaunchMail=129]="LaunchMail",s[s.LaunchApp2=130]="LaunchApp2",s[s.Clear=131]="Clear",s[s.MAX_VALUE=132]="MAX_VALUE",s))(C||{});class me{_keyCodeToStr;_strToKeyCode;constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(t,e){this._keyCodeToStr[t]=e,this._strToKeyCode[e.toLowerCase()]=t}keyCodeToStr(t){return this._keyCodeToStr[t]}strToKeyCode(t){return this._strToKeyCode[t.toLowerCase()]||0}}const de=new me,Wi=new me,Xi=new me,es=new Array(230),ji=Object.create(null),Gi=Object.create(null);(function(){const t=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN","",""],[1,1,"Hyper",0,"",0,"","",""],[1,2,"Super",0,"",0,"","",""],[1,3,"Fn",0,"",0,"","",""],[1,4,"FnLock",0,"",0,"","",""],[1,5,"Suspend",0,"",0,"","",""],[1,6,"Resume",0,"",0,"","",""],[1,7,"Turbo",0,"",0,"","",""],[1,8,"Sleep",0,"",0,"VK_SLEEP","",""],[1,9,"WakeUp",0,"",0,"","",""],[0,10,"KeyA",31,"A",65,"VK_A","",""],[0,11,"KeyB",32,"B",66,"VK_B","",""],[0,12,"KeyC",33,"C",67,"VK_C","",""],[0,13,"KeyD",34,"D",68,"VK_D","",""],[0,14,"KeyE",35,"E",69,"VK_E","",""],[0,15,"KeyF",36,"F",70,"VK_F","",""],[0,16,"KeyG",37,"G",71,"VK_G","",""],[0,17,"KeyH",38,"H",72,"VK_H","",""],[0,18,"KeyI",39,"I",73,"VK_I","",""],[0,19,"KeyJ",40,"J",74,"VK_J","",""],[0,20,"KeyK",41,"K",75,"VK_K","",""],[0,21,"KeyL",42,"L",76,"VK_L","",""],[0,22,"KeyM",43,"M",77,"VK_M","",""],[0,23,"KeyN",44,"N",78,"VK_N","",""],[0,24,"KeyO",45,"O",79,"VK_O","",""],[0,25,"KeyP",46,"P",80,"VK_P","",""],[0,26,"KeyQ",47,"Q",81,"VK_Q","",""],[0,27,"KeyR",48,"R",82,"VK_R","",""],[0,28,"KeyS",49,"S",83,"VK_S","",""],[0,29,"KeyT",50,"T",84,"VK_T","",""],[0,30,"KeyU",51,"U",85,"VK_U","",""],[0,31,"KeyV",52,"V",86,"VK_V","",""],[0,32,"KeyW",53,"W",87,"VK_W","",""],[0,33,"KeyX",54,"X",88,"VK_X","",""],[0,34,"KeyY",55,"Y",89,"VK_Y","",""],[0,35,"KeyZ",56,"Z",90,"VK_Z","",""],[0,36,"Digit1",22,"1",49,"VK_1","",""],[0,37,"Digit2",23,"2",50,"VK_2","",""],[0,38,"Digit3",24,"3",51,"VK_3","",""],[0,39,"Digit4",25,"4",52,"VK_4","",""],[0,40,"Digit5",26,"5",53,"VK_5","",""],[0,41,"Digit6",27,"6",54,"VK_6","",""],[0,42,"Digit7",28,"7",55,"VK_7","",""],[0,43,"Digit8",29,"8",56,"VK_8","",""],[0,44,"Digit9",30,"9",57,"VK_9","",""],[0,45,"Digit0",21,"0",48,"VK_0","",""],[1,46,"Enter",3,"Enter",13,"VK_RETURN","",""],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE","",""],[1,48,"Backspace",1,"Backspace",8,"VK_BACK","",""],[1,49,"Tab",2,"Tab",9,"VK_TAB","",""],[1,50,"Space",10,"Space",32,"VK_SPACE","",""],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,"",0,"","",""],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL","",""],[1,64,"F1",59,"F1",112,"VK_F1","",""],[1,65,"F2",60,"F2",113,"VK_F2","",""],[1,66,"F3",61,"F3",114,"VK_F3","",""],[1,67,"F4",62,"F4",115,"VK_F4","",""],[1,68,"F5",63,"F5",116,"VK_F5","",""],[1,69,"F6",64,"F6",117,"VK_F6","",""],[1,70,"F7",65,"F7",118,"VK_F7","",""],[1,71,"F8",66,"F8",119,"VK_F8","",""],[1,72,"F9",67,"F9",120,"VK_F9","",""],[1,73,"F10",68,"F10",121,"VK_F10","",""],[1,74,"F11",69,"F11",122,"VK_F11","",""],[1,75,"F12",70,"F12",123,"VK_F12","",""],[1,76,"PrintScreen",0,"",0,"","",""],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL","",""],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE","",""],[1,79,"Insert",19,"Insert",45,"VK_INSERT","",""],[1,80,"Home",14,"Home",36,"VK_HOME","",""],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR","",""],[1,82,"Delete",20,"Delete",46,"VK_DELETE","",""],[1,83,"End",13,"End",35,"VK_END","",""],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT","",""],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",""],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",""],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",""],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",""],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK","",""],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE","",""],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY","",""],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT","",""],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD","",""],[1,94,"NumpadEnter",3,"",0,"","",""],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1","",""],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2","",""],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3","",""],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4","",""],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5","",""],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6","",""],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7","",""],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8","",""],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9","",""],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0","",""],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL","",""],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102","",""],[1,107,"ContextMenu",58,"ContextMenu",93,"","",""],[1,108,"Power",0,"",0,"","",""],[1,109,"NumpadEqual",0,"",0,"","",""],[1,110,"F13",71,"F13",124,"VK_F13","",""],[1,111,"F14",72,"F14",125,"VK_F14","",""],[1,112,"F15",73,"F15",126,"VK_F15","",""],[1,113,"F16",74,"F16",127,"VK_F16","",""],[1,114,"F17",75,"F17",128,"VK_F17","",""],[1,115,"F18",76,"F18",129,"VK_F18","",""],[1,116,"F19",77,"F19",130,"VK_F19","",""],[1,117,"F20",78,"F20",131,"VK_F20","",""],[1,118,"F21",79,"F21",132,"VK_F21","",""],[1,119,"F22",80,"F22",133,"VK_F22","",""],[1,120,"F23",81,"F23",134,"VK_F23","",""],[1,121,"F24",82,"F24",135,"VK_F24","",""],[1,122,"Open",0,"",0,"","",""],[1,123,"Help",0,"",0,"","",""],[1,124,"Select",0,"",0,"","",""],[1,125,"Again",0,"",0,"","",""],[1,126,"Undo",0,"",0,"","",""],[1,127,"Cut",0,"",0,"","",""],[1,128,"Copy",0,"",0,"","",""],[1,129,"Paste",0,"",0,"","",""],[1,130,"Find",0,"",0,"","",""],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE","",""],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP","",""],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN","",""],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR","",""],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1","",""],[1,136,"KanaMode",0,"",0,"","",""],[0,137,"IntlYen",0,"",0,"","",""],[1,138,"Convert",0,"",0,"","",""],[1,139,"NonConvert",0,"",0,"","",""],[1,140,"Lang1",0,"",0,"","",""],[1,141,"Lang2",0,"",0,"","",""],[1,142,"Lang3",0,"",0,"","",""],[1,143,"Lang4",0,"",0,"","",""],[1,144,"Lang5",0,"",0,"","",""],[1,145,"Abort",0,"",0,"","",""],[1,146,"Props",0,"",0,"","",""],[1,147,"NumpadParenLeft",0,"",0,"","",""],[1,148,"NumpadParenRight",0,"",0,"","",""],[1,149,"NumpadBackspace",0,"",0,"","",""],[1,150,"NumpadMemoryStore",0,"",0,"","",""],[1,151,"NumpadMemoryRecall",0,"",0,"","",""],[1,152,"NumpadMemoryClear",0,"",0,"","",""],[1,153,"NumpadMemoryAdd",0,"",0,"","",""],[1,154,"NumpadMemorySubtract",0,"",0,"","",""],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR","",""],[1,156,"NumpadClearEntry",0,"",0,"","",""],[1,0,"",5,"Ctrl",17,"VK_CONTROL","",""],[1,0,"",4,"Shift",16,"VK_SHIFT","",""],[1,0,"",6,"Alt",18,"VK_MENU","",""],[1,0,"",57,"Meta",91,"VK_COMMAND","",""],[1,157,"ControlLeft",5,"",0,"VK_LCONTROL","",""],[1,158,"ShiftLeft",4,"",0,"VK_LSHIFT","",""],[1,159,"AltLeft",6,"",0,"VK_LMENU","",""],[1,160,"MetaLeft",57,"",0,"VK_LWIN","",""],[1,161,"ControlRight",5,"",0,"VK_RCONTROL","",""],[1,162,"ShiftRight",4,"",0,"VK_RSHIFT","",""],[1,163,"AltRight",6,"",0,"VK_RMENU","",""],[1,164,"MetaRight",57,"",0,"VK_RWIN","",""],[1,165,"BrightnessUp",0,"",0,"","",""],[1,166,"BrightnessDown",0,"",0,"","",""],[1,167,"MediaPlay",0,"",0,"","",""],[1,168,"MediaRecord",0,"",0,"","",""],[1,169,"MediaFastForward",0,"",0,"","",""],[1,170,"MediaRewind",0,"",0,"","",""],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK","",""],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK","",""],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP","",""],[1,174,"Eject",0,"",0,"","",""],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE","",""],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT","",""],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL","",""],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2","",""],[1,179,"LaunchApp1",0,"",0,"VK_MEDIA_LAUNCH_APP1","",""],[1,180,"SelectTask",0,"",0,"","",""],[1,181,"LaunchScreenSaver",0,"",0,"","",""],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH","",""],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME","",""],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK","",""],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD","",""],[1,186,"BrowserStop",0,"",0,"VK_BROWSER_STOP","",""],[1,187,"BrowserRefresh",0,"",0,"VK_BROWSER_REFRESH","",""],[1,188,"BrowserFavorites",0,"",0,"VK_BROWSER_FAVORITES","",""],[1,189,"ZoomToggle",0,"",0,"","",""],[1,190,"MailReply",0,"",0,"","",""],[1,191,"MailForward",0,"",0,"","",""],[1,192,"MailSend",0,"",0,"","",""],[1,0,"",114,"KeyInComposition",229,"","",""],[1,0,"",116,"ABNT_C2",194,"VK_ABNT_C2","",""],[1,0,"",96,"OEM_8",223,"VK_OEM_8","",""],[1,0,"",0,"",0,"VK_KANA","",""],[1,0,"",0,"",0,"VK_HANGUL","",""],[1,0,"",0,"",0,"VK_JUNJA","",""],[1,0,"",0,"",0,"VK_FINAL","",""],[1,0,"",0,"",0,"VK_HANJA","",""],[1,0,"",0,"",0,"VK_KANJI","",""],[1,0,"",0,"",0,"VK_CONVERT","",""],[1,0,"",0,"",0,"VK_NONCONVERT","",""],[1,0,"",0,"",0,"VK_ACCEPT","",""],[1,0,"",0,"",0,"VK_MODECHANGE","",""],[1,0,"",0,"",0,"VK_SELECT","",""],[1,0,"",0,"",0,"VK_PRINT","",""],[1,0,"",0,"",0,"VK_EXECUTE","",""],[1,0,"",0,"",0,"VK_SNAPSHOT","",""],[1,0,"",0,"",0,"VK_HELP","",""],[1,0,"",0,"",0,"VK_APPS","",""],[1,0,"",0,"",0,"VK_PROCESSKEY","",""],[1,0,"",0,"",0,"VK_PACKET","",""],[1,0,"",0,"",0,"VK_DBE_SBCSCHAR","",""],[1,0,"",0,"",0,"VK_DBE_DBCSCHAR","",""],[1,0,"",0,"",0,"VK_ATTN","",""],[1,0,"",0,"",0,"VK_CRSEL","",""],[1,0,"",0,"",0,"VK_EXSEL","",""],[1,0,"",0,"",0,"VK_EREOF","",""],[1,0,"",0,"",0,"VK_PLAY","",""],[1,0,"",0,"",0,"VK_ZOOM","",""],[1,0,"",0,"",0,"VK_NONAME","",""],[1,0,"",0,"",0,"VK_PA1","",""],[1,0,"",0,"",0,"VK_OEM_CLEAR","",""]],e=[],i=[];for(const n of t){const[r,o,a,h,u,p,f,g,w]=n;if(i[o]||(i[o]=!0,ji[a]=o,Gi[a.toLowerCase()]=o),!e[h]){if(e[h]=!0,!u)throw new Error(`String representation missing for key code ${h} around scan code ${a}`);de.define(h,u),Wi.define(h,g||u),Xi.define(h,w||g||u)}p&&(es[p]=h)}})();function Zi(s){return de.keyCodeToStr(s)}function zi(s){return de.strToKeyCode(s)}var Y=(s=>(s[s.CtrlCmd=2048]="CtrlCmd",s[s.Shift=1024]="Shift",s[s.Alt=512]="Alt",s[s.WinCtrl=256]="WinCtrl",s))(Y||{});class ht{static tempMatrix=new S;static rotate(t,e,i){const n=[];return t.forEach(r=>{const o=i||r.getCenter(),{OBB:a}=r,h={a:Math.cos(e),b:Math.sin(e),c:-Math.sin(e),d:Math.cos(e),tx:0,ty:0},[u,p]=S.fromMatrixOrigin([0,0],h,o);h.tx=u,h.ty=p;const f=S.apply(v(a.x,a.y),h),{transform:g}=r,w={a:g.a,b:g.b,c:-g.b,d:g.a,tx:g.tx,ty:g.ty},A={a:1,b:0,c:g.a*g.c+g.b*g.d,d:1,tx:0,ty:0};S.multiply(h,w,h),S.multiply(h,h,A),[h.tx,h.ty]=f,n.push(ot.update(r.getGuidKey(),{transform:{...h}}))}),n}static _getInvertSelectBoxTransform(t){return S.invert({...t,tx:0,ty:0})}static _getPointOnSelectBoxAxis(t,e){const{x:i,y:n,transform:r}=t,o=this._getInvertSelectBoxTransform(r);return S.apply(v(e[0]-i,e[1]-n),o)}static _getNewPointOnSelectBoxChange(t,e,i,n,r){const o=R(r,e),a=Nt(o,t),h=je(i,a);return Z(n,h)}static _getRectInfoBeforeAndAfter(t,e,i){const{x:n,y:r,transform:o,width:a,height:h}=t,u=v(n,r),p=v(a,h),f=this._getPointOnSelectBoxAxis(t,e),g=v(0,0),w=v(t.width,t.height),A=V(g),M=V(w);Oi(i)&&([A[0]]=f),Di(i)&&([,A[1]]=f),Ri(i)&&([M[0]]=f),Pi(i)&&([,M[1]]=f);const E=Z(u,S.apply(A,{...o,tx:0,ty:0})),y=R(M,A);return{oldSelectBoxTL:u,oldSelectBoxRect:p,newSelectBoxTL:E,newSelectBoxRect:y}}static _calculateObjectControlPoints=(t,e,i)=>{const{x:n,y:r,width:o,height:a,transform:h}=t,u={...h,tx:0,ty:0},p=this._getInvertSelectBoxTransform(i),f=S.multiply(u,u,p),g=v(n,r),w=Z(g,S.apply(v(o,0),f)),A=Z(g,S.apply(v(0,a),f)),M=e(g),E=e(w),y=e(A),_=R(E,M);return{transformedTopLeftPoint:M,transformedTopRightPoint:E,transformedBottomLeftVector:y,transformedWidthVector:_}};static _computeGeometryFromTransformedPoints=t=>{const e=Math.atan2(t[1],t[0]);return{a:Math.cos(e),b:Math.sin(e),c:-Math.sin(e),d:Math.cos(e),tx:0,ty:0}};static _checkFlipVertically=(t,e,i,n)=>{const r=be(e,t),o=be(e,S.apply(i,n));return r*o<0};static __calculateTransformedObjectHeightSkew=t=>{const e=Math.PI/2-Math.atan2(t[1],t[0]);return{a:1,b:0,c:Math.tan(e),d:1,tx:0,ty:0}};static _updateObjectGeometryAfterResize(t,e,i,n,r,o,a){S.multiply(this.tempMatrix,t,e),S.multiply(this.tempMatrix,this.tempMatrix,i);const{a:h,b:u,c:p,d:f}=this.tempMatrix;return{size:{x:n,y:r},transform:{a:h,b:u,c:p*(a?-1:1),d:f*(a?-1:1),tx:o[0],ty:o[1]}}}static _calculateTransformedObjectGeometry=(t,e,i)=>{const{height:n}=t,{transformedTopLeftPoint:r,transformedBottomLeftVector:o,transformedWidthVector:a}=ht._calculateObjectControlPoints(t,e,i),h=this._computeGeometryFromTransformedPoints(a),u=R(o,r),p=this._checkFlipVertically(u,a,v(0,n),h),f=S.invert(h),g=S.apply(u,f),w=this.__calculateTransformedObjectHeightSkew(g);S.multiply(this.tempMatrix,h,w),S.multiply(this.tempMatrix,this.tempMatrix,i);const{a:A,b:M,c:E,d:y}=this.tempMatrix;return this._updateObjectGeometryAfterResize(h,w,i,Ge(a),Math.abs(g[1]),r,p)};static resize(t,e,i){const{transform:n}=i.OBB,{oldSelectBoxTL:r,oldSelectBoxRect:o,newSelectBoxTL:a,newSelectBoxRect:h}=this._getRectInfoBeforeAndAfter(i.OBB,e,t),u=g=>this._getNewPointOnSelectBoxChange.call(this,o,r,h,a,g),p=i.getObjects(),f=[];return p.forEach(g=>{f.push(ot.update(g.getGuidKey(),this._calculateTransformedObjectGeometry(g.OBB,u,n)))}),f}static move(t,e){const i=[];return e.forEach(n=>{const{x:r,y:o,transform:a}=n;let h,u;pt(t)?[h,u]=t([r,o]):[h,u]=t,i.push(ot.update(n.getGuidKey(),{transform:{...a,tx:h,ty:u}}))}),i}}class Ji{static setFills(t,e){return t.map(i=>ot.update(i.getGuidKey(),{fillPaints:e??[]}))}}const Qi=[v(0,1),v(1,0)],qi=v(0,0);function Qt(s,t,e){return e===0?!1:ne(R(t,s))<=e*e}class $i{static _pointInTriangle(t,e){const i=V(t),n=e[0],r=e[1],o=e[2],a=R(o,n),h=R(r,n),u=R(i,n),p=G(a,a),f=G(a,h),g=G(a,u),w=G(h,h),A=G(h,u),M=p*w-f*f,E=M===0?0:1/M,y=(w*g-f*A)*E,_=(p*A-f*g)*E;return y>=0&&_>=0&&y+_<1}static _lineCircleCollide(t,e,i,n,r){if(Qt(t,i,n))return r&&V(t,r),!0;if(Qt(e,i,n))return r&&(r=V(t,r)),!0;const o=R(e,t),a=R(i,t),h=ne(o),u=v(0,0);if(h>0){const f=G(a,o)/h;u[0]=o[0]*f,u[1]=o[1]*f}r||(r=qi),Z(t,u,r);const p=ne(u);return Qt(r,i,n)&&p<=h&&G(u,o)>=0}static _singleTriangleCircleCollision(t,e,i){return!!(this._pointInTriangle(e,t)||this._lineCircleCollide(t[0],t[1],e,i)||this._lineCircleCollide(t[1],t[2],e,i)||this._lineCircleCollide(t[2],t[0],e,i))}static collision(t,e,i){return t[0]instanceof Array?t.some(r=>this._singleTriangleCircleCollision(r,e,i)):this._singleTriangleCircleCollision(t,e,i)}}class tn{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}}const Ie=(s,t)=>{const e=[],i=v(0,0);return t.forEach(n=>{V(n,i),e.push(G(i,s))}),new tn(Math.min(...e),Math.max(...e))};class en{static test(t,e){return t.overlaps(e)}static _getRectPointFromTopLeft(t){const{width:e,height:i}=t;return[v(0,0),v(e,0),v(e,i),v(0,i)].map(n=>S.apply(n,t.transform))}static _getRectangleAxis(t){const e=this._getRectPointFromTopLeft(t),i=[];for(let n=1,r=e.length;n<r;n++){const o=R(e[n],e[n-1]);i.push(ei(o))}return i}static _getSelectBoxPoint(t){const{x:e,y:i,width:n,height:r}=t.getRectangle();return[v(e,i),v(e+n,i),v(e+n,i+r),v(e,i+r)]}static _testRectangle(t,e){let i,n;const r=this._getRectangleAxis(e).concat(Qi),o=this._getRectPointFromTopLeft(e);let a=!0;return r.forEach(h=>{i=Ie(h,t),n=Ie(h,o),i.overlaps(n)||(a=!1)}),a}static _transformEllipseToCircle(t){const{width:e,height:i,x:n,y:r}=t,o=new S;e>i?o.a=i/e:o.d=e/i;const a=S.apply(v(e/2,i/2),{...t.transform,tx:0,ty:0});a[0]+=n,a[1]+=r;const h=S.apply(a,o);return S.multiply(o,o,t.transform),o.b=0,o.c=0,o.tx=0,o.ty=0,{currentMatrix:o,newCenter:h,radius:Math.min(e,i)/2}}static _testEllipse(t,e){const{currentMatrix:i,newCenter:n,radius:r}=this._transformEllipseToCircle(e),[o,a,h,u]=t.map(p=>S.apply(p,i));return $i.collision([[o,a,u],[h,a,u]],n,r)}static testObject(t,e){const i=this._getSelectBoxPoint(t);let n=!1;switch(e.type){case O.ELLIPSE:n=this._testEllipse(i,e);break;case O.RECTANGLE:n=this._testRectangle(i,e);break}return n}static testCollision(t,e){return e.filter(i=>this.testObject(t,i))}}class H{static _instances=new Map;static EditorContext=new H("EditorContext");id;constructor(t){if(H._instances.has(t))throw new TypeError(`MenuId with identifier '${t}' already exists. Use MenuId.for(ident) or a unique identifier`);H._instances.set(t,this),this.id=t}}class kt{constructor(t){this.id=t,this.has=e=>e===t}static _all=new Map;static for(t){let e=this._all.get(t);return e||(e=new kt(t),this._all.set(t,e)),e}static merge(t){const e=new Set;for(const i of t)i instanceof kt&&e.add(i.id);return e}has}const pe=new class{_onDidChangeMenu=new D;onDidChangeMenu=this._onDidChangeMenu.event;_menuItems=new Map;appendMenuItem(s,t){let e=this._menuItems.get(s);e||(e=new Ut,this._menuItems.set(s,e));const i=e.push(t);return this._onDidChangeMenu.fire(kt.for(s)),i}appendMenuItems(s){const t=[];for(const{id:e,item:i}of s)t.push(this.appendMenuItem(e,i));return t}getMenuItems(s){let t;return this._menuItems.has(s)?t=[...this._menuItems.get(s)]:t=[],t}};function sn(){const s={command:{id:"editor.action.copy",title:"复制",tooltip:"复制选中的元素"},group:"clipboard",order:1},t={command:{id:"editor.action.paste",title:"粘贴",tooltip:"粘贴元素"},group:"clipboard",order:2},e={command:{id:"editor.action.selectAll",title:"全选",tooltip:"选择所有元素"},group:"selection",order:1},i={command:{id:"editor.action.properties",title:"属性",tooltip:"查看元素属性"},group:"properties",order:1};pe.appendMenuItems([{id:H.EditorContext,item:s},{id:H.EditorContext,item:t},{id:H.EditorContext,item:e},{id:H.EditorContext,item:i}])}function nn(){sn(),console.log("Context menus initialized")}nn();function rn(s){return new Error(`Illegal argument: ${s}`)}function on(s){throw new Error("is unknown")}let ss=!1,_e=!1,is=!1,ns=!1;const B=navigator.userAgent;ss=B.indexOf("Windows")>=0;_e=B.indexOf("Macintosh")>=0;ns=(B.indexOf("Macintosh")>=0||B.indexOf("iPad")>=0||B.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0;is=B.indexOf("Linux")>=0;B?.indexOf("Mobi")>=0;const gt=_e,an=is,cn=B.indexOf("Firefox")>=0,hn=B.indexOf("AppleWebKit")>=0,ln=B.indexOf("Chrome")>=0;!ln&&B.indexOf("Safari")>=0;B.indexOf("Electron/")>=0;B.indexOf("Android")>=0;var ae=(s=>(s[s.Windows=1]="Windows",s[s.Macintosh=2]="Macintosh",s[s.Linux=3]="Linux",s))(ae||{});const Oe=_e||ns?2:ss?1:3;class at{constructor(t,e,i,n,r){this.ctrlKey=t,this.shiftKey=e,this.altKey=i,this.metaKey=n,this.keyCode=r}equals(t){return t instanceof at&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}isModifierKey(){return this.keyCode===C.Unknown||this.keyCode===C.Ctrl||this.keyCode===C.Meta||this.keyCode===C.Alt||this.keyCode===C.Shift}}class qt{chords;constructor(t){if(t.length===0)throw rn("chords");this.chords=t}equals(t){if(t===null||this.chords.length!==t.chords.length)return!1;for(let e=0;e<this.chords.length;e++)if(!this.chords[e].equals(t.chords[e]))return!1;return!0}}function xt(s,t){const e=!!(s&2048),i=!!(s&256),n=t===ae.Macintosh?i:e,r=!!(s&1024),o=!!(s&512),a=t===ae.Macintosh?e:i,h=s&255;return new at(n,r,o,a,h)}function De(s,t){if(typeof s=="number"){if(s===0)return null;const i=(s&65535)>>>0,n=(s&4294901760)>>>16;return n!==0?new qt([xt(i,t),xt(n,t)]):new qt([xt(i,t)])}const e=[];for(let i=0;i<s.length;i++)e.push(xt(s[i],t));return new qt(e)}class Re{_chords;constructor(t){this._chords=t}getDispatchChords(){return this._chords.map(t=>this._getDispatchChord(t))}_getDispatchChord(t){if(t.isModifierKey())return null;let e="";return t.ctrlKey&&(e+="ctrl+"),t.shiftKey&&(e+="shift+"),t.altKey&&(e+="alt+"),t.metaKey&&(e+="meta+"),e+=Zi(t.keyCode),e}}function rs(s){const t=[];for(let e=0,i=s.length;e<i;e++){const n=s[e];if(!n)return[];t.push(n)}return t}class un{resolvedKeybinding;chords;command;commandArgs;constructor(t,e,i){this.resolvedKeybinding=t,this.chords=t?rs(t.getDispatchChords()):[],this.command=e,this.commandArgs=i}}class mn{_coreKeybindings=new Ut;registerKeybindingRule(t){if(t&&t.primary){const e=De(t.primary,Oe);e&&this._registerDefaultKeybinding(e,t.id,t.args,t.weight)}if(t&&Array.isArray(t.secondary))for(let e=0,i=t.secondary.length;e<i;e++){const n=t.secondary[e],r=De(n,Oe);r&&this._registerDefaultKeybinding(r,t.id,t.args,t.weight)}}_registerDefaultKeybinding(t,e,i,n){return this._coreKeybindings.push({keybinding:t,command:e,commandArgs:i,weight:n})}getDefaultKeybindings(){return Array.from(this._coreKeybindings)}}const os=new mn,fe=new class{_commands=new Map;_onDidRegisterCommand=new D;onDidRegisterCommand=this._onDidRegisterCommand.event;registerCommand(s,t){if(!s)throw new Error("invalid command");if(typeof s=="string"){if(!t)throw new Error("invalid command");return this.registerCommand({id:s,handler:t})}const{id:e}=s;let i=this._commands.get(e);i||(i=new Ut,this._commands.set(e,i));const n=i.unshift(s),r=()=>{n(),this._commands.get(e)?.isEmpty()&&this._commands.delete(e)};return this._onDidRegisterCommand.fire(e),r}getCommand(s){const t=this._commands.get(s);if(!(!t||t.isEmpty()))return t[Symbol.iterator]().next().value}getCommands(){const s=new Map;for(const t of this._commands.keys()){const e=this.getCommand(t);e&&s.set(t,e)}return s}};fe.registerCommand("noop",()=>{});class dn{id;_kbOpts;_menu;constructor(t){this.id=t.id,this._kbOpts=t.kbOpts,this._menu=t.menu}register(){if(this._kbOpts&&(Array.isArray(this._kbOpts)?this._kbOpts:[this._kbOpts]).forEach(e=>{const i={id:this.id,weight:e.weight,args:e.args,primary:e.primary,secondary:e.secondary};os.registerKeybindingRule(i)}),this._menu){const{id:t,...e}=this._menu;pe.appendMenuItem(this._menu.id,{...e,command:{...e,id:this.id}})}fe.registerCommand(this.id,t=>this.runCommand(t))}}const pn=s=>s instanceof F&&!(s instanceof ue)&&!(s instanceof wt);function ye(s){return s.register(),s}class k extends dn{runCommand(t){const e=globalThis.getEditor()._getViewModel();e&&this.runCoreEditorCommand(e,t||{})}}const _n=new class extends k{constructor(){super({id:"setActiveSelection"})}runCoreEditorCommand(s,t){const{target:e,multipleMode:i}=t;if(!pn(e))return!i&&s.discardActiveSelection();const n=s.getActiveSelection();i?n.hasSelected(e)?s.removeSelectElement(e):s.addSelectElement(e):(s.discardActiveSelection(),s.addSelectElement(e))}},Pe=new class extends k{constructor(){super({id:"mouseBoxSelect"})}runCoreEditorCommand(s,t){const{startPosition:e,position:i}=t;if(!e||!i)return s.setBoxSelectBounds();s.setBoxSelectBounds([e,i]);const n=s.getBoxSelectBounds(),{minX:r,minY:o,maxX:a,maxY:h}=n,p=re.search({minX:r,minY:o,maxX:a,maxY:h}).map(g=>g.displayObject),f=en.testCollision(n,p);s.discardActiveSelection(),f.length&&f.forEach(s.addSelectElement)}},Be=new class extends k{constructor(){super({id:"createElement"})}_getCreateResizeKey(s,t){const[e,i]=t,[n,r]=s;let o=T.SELECT_RESIZE_RIGHT_BOTTOM;return r<i?n<e?o=T.SELECT_RESIZE_LEFT_TOP:o=T.SELECT_RESIZE_RIGHT_TOP:n<e&&(o=T.SELECT_RESIZE_LEFT_BOTTOM),o}_resizeActiveCreate(s,t,e){cs.runCoreEditorCommand(s,{key:this._getCreateResizeKey(t,e),position:t})}_createElement(s,t,e){const i=s.getCursorCreateElementType();let[n,r]=t,o={};e?o={width:1,height:1}:(n-=50,r-=50);let a;return i===O.RECTANGLE&&(a=Ye({left:n,top:r,...o})),a}_calcPaintElementPosition(s){let t=1,e=s.length;s.length>2&&(t=Math.ceil(Math.sqrt(s.length)),e=s.length/t>>0);const i=[],n=v(0,0),r=v(0,0);return s.forEach((o,a)=>{i.push({position:v(r[0],n[1]),paint:o}),r[0]+=o.originalImageWidth,r[1]=Math.max(r[1],o.originalImageHeight),(a+1)%e||(n[0]=Math.max(r[0],n[0]),n[1]+=r[1],r[1]=0,r[0]=0)}),{paintElementsPosition:i,paintElementsBox:n}}_createByPaint(s,t,e){return e&&(s.fillPaints=[e]),[s.transform.tx,s.transform.ty]=t,s.size.x=e.originalImageWidth,s.size.y=e.originalImageHeight,s.name=e.image.name,s}_createByPaints(s,t,e){const{paintElementsPosition:i,paintElementsBox:n}=this._calcPaintElementPosition(e),r=R(t,Nt(n,v(2,2)));return i.map(o=>{const{position:a,paint:h}=o,u=Q(s);return u.guid=Bt(),this._createByPaint(u,Z(a,r),h)})}_resetPosition(s,t,e,i){let n=e;s.forEach(r=>{r.parentIndex.guid=JSON.parse(JSON.stringify(t)),n=fi(n,i),n||(n=r.parentIndex.position),r.parentIndex.position=n})}_resetName(s,t){const{elementTreeRoot:e}=t,i={};return s.forEach(n=>{const{type:r}=n;if(!i[r]){const o=e.getElementByTagName(r);o.length?i[r]=o[o.length-1].name.match(/\d+$/)?.[0]||0:i[r]=0}n.name=`${r} ${++i[r]}`}),s}_runCoreEditorCommand(s,t){const{position:e,startPosition:i,paint:n,sourceElement:r}=t;if(!i)return;const o=[];if(r){const a=Q(r);a.guid=Bt(),o.push(a)}if(n){const a=Array.isArray(n)?n:[n];o.push(...this._createByPaints(this._createElement(s,i,e),i,a))}return o.push(this._createElement(s,i,e)),o}runCoreEditorCommand(s,t){const{position:e,startPosition:i,insertAfter:n,insertBefore:r,parent:o}=t;if(!i||!o)return;if(s.getActiveSelection().isActive()&&e)this._resizeActiveCreate(s,e,i);else{const h=[],u=this._runCoreEditorCommand(s,t);u&&(this._resetPosition(u,o,n,r),this._resetName(u,s),h.push(...u.map(p=>ot.create(p.guid,p)))),s.getModel().pushEditOperations(h)}}},as=new class extends k{constructor(){super({id:"moveElementTo"})}runCoreEditorCommand(s,t){const{position:e,objects:i}=t;!e||!i||!i.length||s.updateNodeWithAABB(ht.move(e,i))}};new class extends k{constructor(){super({id:"moveElement"})}runCoreEditorCommand(s,t){let{objects:e}=t;const{movement:i}=t;e||(e=s.getActiveSelection().getObjects()),!(!e||!i)&&s.getModel().pushEditOperations(ht.move(n=>Z(n,i),e))}};const fn=new class extends k{constructor(){super({id:"rotateElement"})}runCoreEditorCommand(s,t){const{objects:e,rad:i,transformOrigin:n}=t;!e||!e.length||!i||s.updateNodeWithAABB(ht.rotate(e,i,n))}};class yn extends k{constructor(){super({id:"resizeElement"})}runCoreEditorCommand(t,e){const{position:i,key:n}=e;if(!i||!n)return;const r=ht.resize(n,i,t.getActiveSelection());r&&t.updateNodeWithAABB(r)}}const cs=new yn,gn=new class extends k{constructor(){super({id:"updateElementFills"})}runCoreEditorCommand(s,t){const{objects:e,newFills:i}=t;!e||!e.length||s.getModel().pushEditOperations(Ji.setFills(e,i))}};ye(new class extends k{constructor(){super({id:"undo",kbOpts:{primary:Y.CtrlCmd|C.KeyZ,weight:1}})}runCoreEditorCommand(s){s.getModel().undo()}});ye(new class extends k{constructor(){super({id:"redo",kbOpts:{primary:Y.CtrlCmd|Y.Shift|C.KeyZ,weight:1}})}runCoreEditorCommand(s){s.getModel().redo()}});ye(new class extends k{constructor(){super({id:"delete",kbOpts:{primary:C.Backspace,weight:1},menu:{id:H.EditorContext,title:"删除",group:"edit"}})}runCoreEditorCommand(s){const e=s.getActiveSelection().getObjects();if(e.length<1)return;const i=e.map(n=>ot.delete(n.getGuidKey()));s.getModel().pushEditOperations(i)}});var En=Object.getOwnPropertyDescriptor,An=(s,t,e,i)=>{for(var n=i>1?void 0:i?En(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(n)||n);return n};const wn=["x","y","width","height"],vn=s=>new Proxy(s,{get(t,e,i){if(typeof e=="string"&&wn.includes(e)){const n=t.getObjects();return n.reduce((r,o)=>o.x===r?r:"MIXED",n[0].x)}return e in t,Reflect.get(t,e,i)}});function Mn(s){new Proxy(s,{construct(t,e){return vn(new t(...e))}})}let ce=class{constructor(s,t){this._viewModel=s,this._activeSelection=t}_onDidSelectionChange=new D;onDidSelectionChange=this._onDidSelectionChange.event;move(s){const t=this._activeSelection.getObjects();as.runCoreEditorCommand(this._viewModel,{position:s,objects:t})}setFills(s){const t=this._activeSelection.getObjects();gn.runCoreEditorCommand(this._viewModel,{newFills:s,objects:t})}getObjects(){return this._activeSelection.getObjects()}};ce=An([Mn],ce);class Sn{constructor(t,e){this._cameraService=e,this.getVisibleElementRenderObjects=this.getVisibleElementRenderObjects.bind(this),this._modelData=t,this._eventDispatcher=new Ks,this._activeSelection=new Li,this._bindCameraEvent(),this._initElementTree(),this._bindModelEvent(),this._bindCursorEvent(),this._cursor.onDidCursorOperateModeChange(i=>{i===N.ReadOnly?this._pickActive=!1:this._pickActive=!0}),this._activeSelectionWidget=new ce(this,this._activeSelection),Vt("getSelectionProxy",()=>this._activeSelectionWidget),Vt("setOperateMode",this.setCursorOperateMode.bind(this))}_focusPageId="";_modelData;pickService;_eventDispatcher;_onFocusPageChange=new D;onFocusPageChange=this._onFocusPageChange.event;_activeSelection;_elementTree;_cursor=new Yi;_pickActive=!0;_cachePickProxy;_activeSelectionWidget;_initElementTree(){this._elementTree=new gi(this._modelData.getCurrentState().elements);for(const t of this._elementTree.document.getChildren())this._createCamera(t.id,t.getBoundingClientRect());this.focusPageId=this._elementTree.document.getChildren()[0].id,this.pickService=new Mi(this.getVisibleElementRenderObjects,this._activeSelection,this.elementTreeRoot)}_createPickProxyCache(){const t=i=>this._pickActive?this.pickService.pick.call(this.pickService,i):this.elementTreeRoot,e=i=>this._pickActive?this.pickService.pickActiveSelection.call(this.pickService,i):T.NONE;this._cachePickProxy={pick:t,pickActiveSelection:e}}get pickProxy(){return this._cachePickProxy||this._createPickProxyCache(),this._cachePickProxy}_bindCameraEvent(){console.log("hasCall"),this._cameraService.onCameraViewChange(t=>{this._eventDispatcher.emitViewEvent(new Hs(t));const e=this._elementTree.getElementById(this._focusPageId);e&&e.setVisibleArea(t.getViewport())})}_onCreateElementHandler(t){const e=this._modelData.getElementSchemaById(t.target);if(!e){console.warn("Element schema not found for target:",t.target);return}const i=this._elementTree.createElementByData(e),n=this._elementTree.getElementById(this._focusPageId);if(!i||!n)return;n?.appendChild(i);const r=this.getCamera();return n?.setVisibleArea(r.getViewport()),this.addSelectElement(i),i}_onUpdateElementHandler(t){const e=this._elementTree.getElementById(t.target),i=this._modelData.getElementSchemaById(t.target);return e&&i&&e.setElementData(i),e}_onDeleteElementHandler(t){const e=this._elementTree.getElementById(t.target);if(e){e.parentNode?.removeChild(e);const i=this._elementTree.getElementById(this._focusPageId),n=this.getCamera();return i?.setVisibleArea(n.getViewport()),this._activeSelection.hasSelected(e)&&this._activeSelection.removeSelectElement(e),e}}_onElementHandler(t){let e;const i=this._modelData.getElementSchemaById(t.target),n=this._elementTree.getElementById(t.target);return i&&n?e=this._onUpdateElementHandler(t):i?e=this._onCreateElementHandler(t):e=this._onDeleteElementHandler(t),e}_bindModelEvent(){this._modelData.onSchemaContentChange(t=>{const e=t.map(this._onElementHandler,this).filter(i=>!!i);this._eventDispatcher.emitViewEvent(new Ys(e,We.ViewElementChanged)),this._activeSelection.updateOBB()})}_bindCursorEvent(){this._cursor.onCursorStateChange(t=>{this._eventDispatcher.emitViewEvent(new Zs(t))})}get focusPageId(){return this._focusPageId}set focusPageId(t){this._focusPageId=t,this._onFocusPageChange.fire(t),this._eventDispatcher.emitViewEvent(new Us(JSON.stringify(t)))}get focusPage(){return this.elementTreeRoot.getElementById(this._focusPageId)}get elementTreeRoot(){return this._elementTree.document}_createCamera(t,e){return this._cameraService.createCamera(t,{size:e,padding:.1})}getCurrentState(){return this._modelData.getCurrentState()}addViewEventHandler(t){this._eventDispatcher.addViewEventHandler(t)}removeViewEventHandler(t){this._eventDispatcher.removeViewEventHandler(t)}getVisibleElementRenderObjects(){const t=this._elementTree.getElementById(this._focusPageId);return t?t.getVisibleElementRenderObjects():[]}getCamera(){return this._cameraService.getCamera(this.focusPageId)}addSelectElement=t=>{this._activeSelection.hasSelected(t)||(this._activeSelection.addSelectElement(t),this._eventDispatcher.emitViewEvent(new Wt([t],Dt.ViewActiveSelectionElementAdded)))};removeSelectElement(t){this._activeSelection.hasSelected(t)&&(this._activeSelection.removeSelectElement(t),this._eventDispatcher.emitViewEvent(new Wt([t],Dt.ViewActiveSelectionElementAdded)))}discardActiveSelection(){this._activeSelection.clear(),this._eventDispatcher.emitViewEvent(new Wt(this._activeSelection.getObjects(),Dt.ViewActiveSelectionElementRemoved))}getActiveSelection(){return this._activeSelection}getCursorHoverObject(){return this._cursor.getHoverObject()}setCursorHoverObject(t){t&&this._activeSelection.hasSelected(t)||this._cursor.setHoverObject(t,this._eventDispatcher)}getCursorHoverControllerKey(){return this._cursor.getControllerKey()}setCursorHoverControllerKey(t){this._cursor.setControllerTarget(t,this._eventDispatcher)}getCursorOperateMode(){return this._cursor.getOperateMode()}setCursorOperateMode(t){this._cursor.setOperateMode(t,this._eventDispatcher)}getCursorCreateElementType(){return this._cursor.getCreateNormalElementType()}setBoxSelectBounds(t){this._cursor.setBoxSelectBounds(this._eventDispatcher,t)}getBoxSelectBounds(){return this._cursor.getBoxSelectBounds()}getModel(){return this._modelData}updateNodeWithAABB(t){this._modelData.pushEditOperations(t)}onElementWillMove=t=>{const e=this.focusPage.getVisibleElementRenderObjects(),i=[];for(const r of e){if(this._activeSelection.hasSelected(r))continue;const o=r.getBounds().getCenter(),a=r.getOBBPoints();i.push([...a,o])}const n=[this._activeSelection.getBounds().getCenter(),...this._activeSelection.getOBBPoints()];return i.length?this._cursor.onElementWillMove(i,n,t):t};onElementDidMove=()=>{const t=[this._activeSelection.getBounds().getCenter(),...this._activeSelection.getOBBPoints()];return this._cursor.onElementDidMove(t)};onElementMoveEnd=()=>{const t=[this._activeSelection.getBounds().getCenter(),...this._activeSelection.getOBBPoints()];this._cursor.onElementMoveEnd(t)}}const Cn="NODE_CHANGES",xn=0,bn=0,Tn=[{guid:{sessionID:0,localID:0},phase:"CREATED",type:"DOCUMENT",name:"Document",visible:!0,opacity:1,blendMode:"PASS_THROUGH",transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},mask:!1,maskIsOutline:!1,maskType:"ALPHA"},{guid:{sessionID:0,localID:1},phase:"CREATED",parentIndex:{guid:{sessionID:0,localID:0},position:"!"},type:"CANVAS",name:"Page 1",visible:!0,opacity:1,blendMode:"PASS_THROUGH",transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},mask:!1,maskIsOutline:!1,maskType:"ALPHA",backgroundOpacity:1,backgroundColor:{r:.9607843160629272,g:.9607843160629272,b:.9607843160629272,a:1},backgroundEnabled:!0,editInfo:{userId:"882982239490455676",lastEditedAt:1689439560,createdAt:0}},{guid:{sessionID:0,localID:2},phase:"CREATED",parentIndex:{guid:{sessionID:0,localID:0},position:"~"},type:"CANVAS",name:"Internal Only Canvas",visible:!1,opacity:1,blendMode:"PASS_THROUGH",transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},mask:!1,maskIsOutline:!1,maskType:"ALPHA",internalOnly:!0},{guid:{sessionID:19,localID:3},phase:"CREATED",parentIndex:{guid:{sessionID:0,localID:1},position:"!"},type:"RECTANGLE",name:"Rectangle 1",visible:!0,locked:!1,opacity:1,blendMode:"PASS_THROUGH",size:{x:460,y:418},transform:{a:1,b:0,tx:-607,c:0,d:1,ty:-825},dashPattern:[],mask:!1,maskType:"ALPHA",cornerRadius:0,strokeWeight:1,strokeAlign:"INSIDE",strokeCap:"NONE",strokeJoin:"MITER",fillPaints:[{type:"SOLID",color:{r:.8509804010391235,g:.8509804010391235,b:.8509804010391235,a:1},opacity:1,visible:!0,blendMode:"NORMAL"},{type:"IMAGE",opacity:1,visible:!0,blendMode:"NORMAL",transform:{a:1,b:0,tx:0,c:0,d:1,ty:0},image:{hash:{0:113,1:45,2:25,3:157,4:148,5:16,6:63,7:63,8:73,9:53,10:80,11:248,12:31,13:147,14:167,15:181,16:148,17:65,18:181,19:40},name:"WechatIMG22466"},imageThumbnail:{hash:{0:168,1:193,2:224,3:113,4:197,5:123,6:218,7:135,8:252,9:231,10:211,11:123,12:180,13:18,14:249,15:81,16:246,17:135,18:126,19:123},name:"WechatIMG22466"},imageScaleMode:"FIT",paintFilter:{tint:-.550000011920929,shadows:-.5400000214576721,highlights:.6600000262260437,exposure:0,temperature:.5199999809265137,vibrance:-.6299999952316284,contrast:.12999999523162842},originalImageWidth:1242,originalImageHeight:1026}],strokePaints:[],fillGeometry:[{windingRule:"NONZERO",commandsBlob:0,styleID:0}],strokeGeometry:[],rectangleTopLeftCornerRadius:0,rectangleTopRightCornerRadius:0,rectangleBottomLeftCornerRadius:0,rectangleBottomRightCornerRadius:0,rectangleCornerRadiiIndependent:!1,rectangleCornerToolIndependent:!1,proportionsConstrained:!1,horizontalConstraint:"MIN",miterLimit:4,verticalConstraint:"MIN",handleMirroring:"NONE",cornerSmoothing:0},{guid:{sessionID:19,localID:4},phase:"CREATED",parentIndex:{guid:{sessionID:0,localID:1},position:'"'},type:"ELLIPSE",name:"Ellipse 1",visible:!0,locked:!1,opacity:1,blendMode:"PASS_THROUGH",size:{x:728,y:409},transform:{a:1,b:0,tx:-124,c:0,d:1,ty:-816},dashPattern:[],mask:!1,maskType:"ALPHA",cornerRadius:0,strokeWeight:1,strokeAlign:"INSIDE",strokeCap:"NONE",strokeJoin:"MITER",fillPaints:[{type:"SOLID",color:{r:.8509804010391235,g:.8509804010391235,b:.8509804010391235,a:1},opacity:1,visible:!0,blendMode:"NORMAL"},{type:"SOLID",color:{r:.9750000238418579,g:.032499998807907104,b:.032499998807907104,a:1},opacity:.3,visible:!0,blendMode:"NORMAL"}],strokePaints:[],fillGeometry:[{windingRule:"NONZERO",commandsBlob:1,styleID:0}],strokeGeometry:[],proportionsConstrained:!1,horizontalConstraint:"MIN",miterLimit:4,verticalConstraint:"MIN",handleMirroring:"NONE",cornerSmoothing:0,arcData:{startingAngle:0,endingAngle:6.2831854820251465,innerRadius:0}},{guid:{sessionID:25,localID:2},phase:"CREATED",parentIndex:{guid:{sessionID:0,localID:1},position:"#"},type:"RECTANGLE",name:"Rectangle 2",visible:!0,locked:!1,opacity:1,blendMode:"PASS_THROUGH",size:{x:530,y:256},transform:{a:.7071067690849304,b:.7071067690849304,tx:-157,c:-.7071067690849304,d:.7071067690849304,ty:-1111},dashPattern:[],mask:!1,maskType:"ALPHA",cornerRadius:0,strokeWeight:1,strokeAlign:"INSIDE",strokeCap:"NONE",strokeJoin:"MITER",fillPaints:[{type:"SOLID",color:{r:.9750000238418579,g:.032499998807907104,b:.032499998807907104,a:1},opacity:1,visible:!0,blendMode:"NORMAL"}],strokePaints:[],fillGeometry:[{windingRule:"NONZERO",commandsBlob:2,styleID:0}],strokeGeometry:[],rectangleTopLeftCornerRadius:0,rectangleTopRightCornerRadius:0,rectangleBottomLeftCornerRadius:0,rectangleBottomRightCornerRadius:0,rectangleCornerRadiiIndependent:!1,rectangleCornerToolIndependent:!1,proportionsConstrained:!1,horizontalConstraint:"MIN",miterLimit:4,verticalConstraint:"MIN",handleMirroring:"NONE",cornerSmoothing:0}],In=["AQAAAAAAAAAAAgAA5kMAAAAAAgAA5kMAANFDAgAAAAAAANFDAgAAAAAAAAAAAA==","AQAANkQAgExDBAAANkSbuJ5DB0INRACAzEMAALZDAIDMQwTm9yJDAIDMQwAAAACbuJ5DAAAAAACATEMEAAAAAJQdt0Lm9yJDAAAAAAAAtkMAAAAABAdCDUQAAAAAAAA2RJQdt0IAADZEAIBMQwA=","AQAAAAAAAAAAAgCABEQAAAAAAgCABEQAAIBDAgAAAAAAAIBDAgAAAAAAAAAAAA=="],On={type:Cn,sessionID:xn,ackID:bn,elements:Tn,blobs:In};class Ht{static INSTANCE=new Ht;_editorTypeRender;_editorTypeRenderInstanceCache;constructor(){this._editorTypeRender=Object.create(null),this._editorTypeRenderInstanceCache=Object.create(null)}registerEditorTypeRender(t,e){this._editorTypeRender[t]=e}getEditorTypeRender(t){if(!this._editorTypeRenderInstanceCache[t]){const e=this._editorTypeRender[t];e&&(this._editorTypeRenderInstanceCache[t]=new e)}return(this._editorTypeRenderInstanceCache[t]||{}).render}}class hs extends Ht{}function ls(s,t){hs.INSTANCE.registerEditorTypeRender(s,t)}function Dn(s){return hs.INSTANCE.getEditorTypeRender(s)}class us extends Ht{}function ms(s,t){us.INSTANCE.registerEditorTypeRender(s,t)}function Rn(s){return us.INSTANCE.getEditorTypeRender(s)}class ge{id=O.RECTANGLE;static hasBorder(t){return t.getBorder()!==null}render=(t,e)=>{const{width:i,height:n}=t;if(ge.hasBorder(t)){const r=t.getBorder();e.roundRect(0,0,i,n,r);return}e.rect(0,0,i,n)}}class Pn{id;render=(t,e)=>{const{width:i,height:n}=t,r=i/2,o=n/2;e.ellipse(r,o,r,o,0,0,2*Math.PI)}}class Bn{id;render(t,e){const{color:i}=t;e.fillStyle=`rgb(${255*i.r}, ${255*i.g}, ${255*i.b})`,e.fill()}}var $t={exports:{}},Ne;function Nn(){return Ne||(Ne=1,(function(s,t){(function(e){s.exports=e()})(function(e){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(y,_){var c=y[0],l=y[1],d=y[2],m=y[3];c+=(l&d|~l&m)+_[0]-680876936|0,c=(c<<7|c>>>25)+l|0,m+=(c&l|~c&d)+_[1]-389564586|0,m=(m<<12|m>>>20)+c|0,d+=(m&c|~m&l)+_[2]+606105819|0,d=(d<<17|d>>>15)+m|0,l+=(d&m|~d&c)+_[3]-1044525330|0,l=(l<<22|l>>>10)+d|0,c+=(l&d|~l&m)+_[4]-176418897|0,c=(c<<7|c>>>25)+l|0,m+=(c&l|~c&d)+_[5]+1200080426|0,m=(m<<12|m>>>20)+c|0,d+=(m&c|~m&l)+_[6]-1473231341|0,d=(d<<17|d>>>15)+m|0,l+=(d&m|~d&c)+_[7]-45705983|0,l=(l<<22|l>>>10)+d|0,c+=(l&d|~l&m)+_[8]+1770035416|0,c=(c<<7|c>>>25)+l|0,m+=(c&l|~c&d)+_[9]-1958414417|0,m=(m<<12|m>>>20)+c|0,d+=(m&c|~m&l)+_[10]-42063|0,d=(d<<17|d>>>15)+m|0,l+=(d&m|~d&c)+_[11]-1990404162|0,l=(l<<22|l>>>10)+d|0,c+=(l&d|~l&m)+_[12]+1804603682|0,c=(c<<7|c>>>25)+l|0,m+=(c&l|~c&d)+_[13]-40341101|0,m=(m<<12|m>>>20)+c|0,d+=(m&c|~m&l)+_[14]-1502002290|0,d=(d<<17|d>>>15)+m|0,l+=(d&m|~d&c)+_[15]+1236535329|0,l=(l<<22|l>>>10)+d|0,c+=(l&m|d&~m)+_[1]-165796510|0,c=(c<<5|c>>>27)+l|0,m+=(c&d|l&~d)+_[6]-1069501632|0,m=(m<<9|m>>>23)+c|0,d+=(m&l|c&~l)+_[11]+643717713|0,d=(d<<14|d>>>18)+m|0,l+=(d&c|m&~c)+_[0]-373897302|0,l=(l<<20|l>>>12)+d|0,c+=(l&m|d&~m)+_[5]-701558691|0,c=(c<<5|c>>>27)+l|0,m+=(c&d|l&~d)+_[10]+38016083|0,m=(m<<9|m>>>23)+c|0,d+=(m&l|c&~l)+_[15]-660478335|0,d=(d<<14|d>>>18)+m|0,l+=(d&c|m&~c)+_[4]-405537848|0,l=(l<<20|l>>>12)+d|0,c+=(l&m|d&~m)+_[9]+568446438|0,c=(c<<5|c>>>27)+l|0,m+=(c&d|l&~d)+_[14]-1019803690|0,m=(m<<9|m>>>23)+c|0,d+=(m&l|c&~l)+_[3]-187363961|0,d=(d<<14|d>>>18)+m|0,l+=(d&c|m&~c)+_[8]+1163531501|0,l=(l<<20|l>>>12)+d|0,c+=(l&m|d&~m)+_[13]-1444681467|0,c=(c<<5|c>>>27)+l|0,m+=(c&d|l&~d)+_[2]-51403784|0,m=(m<<9|m>>>23)+c|0,d+=(m&l|c&~l)+_[7]+1735328473|0,d=(d<<14|d>>>18)+m|0,l+=(d&c|m&~c)+_[12]-1926607734|0,l=(l<<20|l>>>12)+d|0,c+=(l^d^m)+_[5]-378558|0,c=(c<<4|c>>>28)+l|0,m+=(c^l^d)+_[8]-2022574463|0,m=(m<<11|m>>>21)+c|0,d+=(m^c^l)+_[11]+1839030562|0,d=(d<<16|d>>>16)+m|0,l+=(d^m^c)+_[14]-35309556|0,l=(l<<23|l>>>9)+d|0,c+=(l^d^m)+_[1]-1530992060|0,c=(c<<4|c>>>28)+l|0,m+=(c^l^d)+_[4]+1272893353|0,m=(m<<11|m>>>21)+c|0,d+=(m^c^l)+_[7]-155497632|0,d=(d<<16|d>>>16)+m|0,l+=(d^m^c)+_[10]-1094730640|0,l=(l<<23|l>>>9)+d|0,c+=(l^d^m)+_[13]+681279174|0,c=(c<<4|c>>>28)+l|0,m+=(c^l^d)+_[0]-358537222|0,m=(m<<11|m>>>21)+c|0,d+=(m^c^l)+_[3]-722521979|0,d=(d<<16|d>>>16)+m|0,l+=(d^m^c)+_[6]+76029189|0,l=(l<<23|l>>>9)+d|0,c+=(l^d^m)+_[9]-640364487|0,c=(c<<4|c>>>28)+l|0,m+=(c^l^d)+_[12]-421815835|0,m=(m<<11|m>>>21)+c|0,d+=(m^c^l)+_[15]+530742520|0,d=(d<<16|d>>>16)+m|0,l+=(d^m^c)+_[2]-995338651|0,l=(l<<23|l>>>9)+d|0,c+=(d^(l|~m))+_[0]-198630844|0,c=(c<<6|c>>>26)+l|0,m+=(l^(c|~d))+_[7]+1126891415|0,m=(m<<10|m>>>22)+c|0,d+=(c^(m|~l))+_[14]-1416354905|0,d=(d<<15|d>>>17)+m|0,l+=(m^(d|~c))+_[5]-57434055|0,l=(l<<21|l>>>11)+d|0,c+=(d^(l|~m))+_[12]+1700485571|0,c=(c<<6|c>>>26)+l|0,m+=(l^(c|~d))+_[3]-1894986606|0,m=(m<<10|m>>>22)+c|0,d+=(c^(m|~l))+_[10]-1051523|0,d=(d<<15|d>>>17)+m|0,l+=(m^(d|~c))+_[1]-2054922799|0,l=(l<<21|l>>>11)+d|0,c+=(d^(l|~m))+_[8]+1873313359|0,c=(c<<6|c>>>26)+l|0,m+=(l^(c|~d))+_[15]-30611744|0,m=(m<<10|m>>>22)+c|0,d+=(c^(m|~l))+_[6]-1560198380|0,d=(d<<15|d>>>17)+m|0,l+=(m^(d|~c))+_[13]+1309151649|0,l=(l<<21|l>>>11)+d|0,c+=(d^(l|~m))+_[4]-145523070|0,c=(c<<6|c>>>26)+l|0,m+=(l^(c|~d))+_[11]-1120210379|0,m=(m<<10|m>>>22)+c|0,d+=(c^(m|~l))+_[2]+718787259|0,d=(d<<15|d>>>17)+m|0,l+=(m^(d|~c))+_[9]-343485551|0,l=(l<<21|l>>>11)+d|0,y[0]=c+y[0]|0,y[1]=l+y[1]|0,y[2]=d+y[2]|0,y[3]=m+y[3]|0}function r(y){var _=[],c;for(c=0;c<64;c+=4)_[c>>2]=y.charCodeAt(c)+(y.charCodeAt(c+1)<<8)+(y.charCodeAt(c+2)<<16)+(y.charCodeAt(c+3)<<24);return _}function o(y){var _=[],c;for(c=0;c<64;c+=4)_[c>>2]=y[c]+(y[c+1]<<8)+(y[c+2]<<16)+(y[c+3]<<24);return _}function a(y){var _=y.length,c=[1732584193,-271733879,-1732584194,271733878],l,d,m,P,X,j;for(l=64;l<=_;l+=64)n(c,r(y.substring(l-64,l)));for(y=y.substring(l-64),d=y.length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<d;l+=1)m[l>>2]|=y.charCodeAt(l)<<(l%4<<3);if(m[l>>2]|=128<<(l%4<<3),l>55)for(n(c,m),l=0;l<16;l+=1)m[l]=0;return P=_*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),X=parseInt(P[2],16),j=parseInt(P[1],16)||0,m[14]=X,m[15]=j,n(c,m),c}function h(y){var _=y.length,c=[1732584193,-271733879,-1732584194,271733878],l,d,m,P,X,j;for(l=64;l<=_;l+=64)n(c,o(y.subarray(l-64,l)));for(y=l-64<_?y.subarray(l-64):new Uint8Array(0),d=y.length,m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<d;l+=1)m[l>>2]|=y[l]<<(l%4<<3);if(m[l>>2]|=128<<(l%4<<3),l>55)for(n(c,m),l=0;l<16;l+=1)m[l]=0;return P=_*8,P=P.toString(16).match(/(.*?)(.{0,8})$/),X=parseInt(P[2],16),j=parseInt(P[1],16)||0,m[14]=X,m[15]=j,n(c,m),c}function u(y){var _="",c;for(c=0;c<4;c+=1)_+=i[y>>c*8+4&15]+i[y>>c*8&15];return _}function p(y){var _;for(_=0;_<y.length;_+=1)y[_]=u(y[_]);return y.join("")}p(a("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function y(_,c){return _=_|0||0,_<0?Math.max(_+c,0):Math.min(_,c)}ArrayBuffer.prototype.slice=function(_,c){var l=this.byteLength,d=y(_,l),m=l,P,X,j,we;return c!==e&&(m=y(c,l)),d>m?new ArrayBuffer(0):(P=m-d,X=new ArrayBuffer(P),j=new Uint8Array(X),we=new Uint8Array(this,d,P),j.set(we),X)}})();function f(y){return/[\u0080-\uFFFF]/.test(y)&&(y=unescape(encodeURIComponent(y))),y}function g(y,_){var c=y.length,l=new ArrayBuffer(c),d=new Uint8Array(l),m;for(m=0;m<c;m+=1)d[m]=y.charCodeAt(m);return _?d:l}function w(y){return String.fromCharCode.apply(null,new Uint8Array(y))}function A(y,_,c){var l=new Uint8Array(y.byteLength+_.byteLength);return l.set(new Uint8Array(y)),l.set(new Uint8Array(_),y.byteLength),l}function M(y){var _=[],c=y.length,l;for(l=0;l<c-1;l+=2)_.push(parseInt(y.substr(l,2),16));return String.fromCharCode.apply(String,_)}function E(){this.reset()}return E.prototype.append=function(y){return this.appendBinary(f(y)),this},E.prototype.appendBinary=function(y){this._buff+=y,this._length+=y.length;var _=this._buff.length,c;for(c=64;c<=_;c+=64)n(this._hash,r(this._buff.substring(c-64,c)));return this._buff=this._buff.substring(c-64),this},E.prototype.end=function(y){var _=this._buff,c=_.length,l,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m;for(l=0;l<c;l+=1)d[l>>2]|=_.charCodeAt(l)<<(l%4<<3);return this._finish(d,c),m=p(this._hash),y&&(m=M(m)),this.reset(),m},E.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},E.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},E.prototype.setState=function(y){return this._buff=y.buff,this._length=y.length,this._hash=y.hash,this},E.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},E.prototype._finish=function(y,_){var c=_,l,d,m;if(y[c>>2]|=128<<(c%4<<3),c>55)for(n(this._hash,y),c=0;c<16;c+=1)y[c]=0;l=this._length*8,l=l.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(l[2],16),m=parseInt(l[1],16)||0,y[14]=d,y[15]=m,n(this._hash,y)},E.hash=function(y,_){return E.hashBinary(f(y),_)},E.hashBinary=function(y,_){var c=a(y),l=p(c);return _?M(l):l},E.ArrayBuffer=function(){this.reset()},E.ArrayBuffer.prototype.append=function(y){var _=A(this._buff.buffer,y),c=_.length,l;for(this._length+=y.byteLength,l=64;l<=c;l+=64)n(this._hash,o(_.subarray(l-64,l)));return this._buff=l-64<c?new Uint8Array(_.buffer.slice(l-64)):new Uint8Array(0),this},E.ArrayBuffer.prototype.end=function(y){var _=this._buff,c=_.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d,m;for(d=0;d<c;d+=1)l[d>>2]|=_[d]<<(d%4<<3);return this._finish(l,c),m=p(this._hash),y&&(m=M(m)),this.reset(),m},E.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},E.ArrayBuffer.prototype.getState=function(){var y=E.prototype.getState.call(this);return y.buff=w(y.buff),y},E.ArrayBuffer.prototype.setState=function(y){return y.buff=g(y.buff,!0),E.prototype.setState.call(this,y)},E.ArrayBuffer.prototype.destroy=E.prototype.destroy,E.ArrayBuffer.prototype._finish=E.prototype._finish,E.ArrayBuffer.hash=function(y,_){var c=h(new Uint8Array(y)),l=p(c);return _?M(l):l},E})})($t)),$t.exports}var Ln=Nn();const Vn=He(Ln);class Fn{_cache=new Map;async add(t,e){if(this._cache.has(t))return this._cache.get(t);const i=await createImageBitmap(e);return this._cache.set(t,i),i}get(t){return this._cache.get(t)}}const Le=new FileReader;class kn{_textureCache=new Fn;_getFileHash(t){const e=new Promise((i,n)=>{Le.onloadend=r=>i(Vn.hashBinary(r.target.result))});return Le.readAsDataURL(t),e}async load(t){const e=await this._getFileHash(t),i=await this._textureCache.add(e,t),{width:n,height:r}=i;return{hash:e,name:t.name,type:t.type,size:{x:n,y:r}}}getTexture(t){return this._textureCache.get(t)}}const Ee=new kn;window.textureManager=Ee;class Kn{id;render=(t,e,i)=>{const{image:n}=t,{hash:r}=n,o=Ee.getTexture(r);!o||!i?.contextSize||(t.imageScaleMode==="FILL"||t.imageScaleMode==="FIT")&&this._renderFillImage(o,i?.contextSize,e,t.imageScaleMode)};_calcFillInfo(t,e,i){const n=Nt(e,t);let[r,o]=n;o<r?i==="FILL"?o=r:r=o:i==="FILL"?r=o:o=r;const a=je(n,t),h=Nt(R(e,a),[2,2]);return{dx:h[0],dy:h[1],dWidth:a[0],dHeight:a[1]}}_renderFillImage=(t,e,i,n)=>{const{width:r,height:o}=t,{dx:a,dy:h,dHeight:u,dWidth:p}=this._calcFillInfo(v(r,o),v(e.width,e.height),n);i.drawImage(t,a,h,p,u)}}var he=(s=>(s[s.Starting=1]="Starting",s[s.Ready=2]="Ready",s[s.Destroy=3]="Destroy",s))(he||{});class W{dispose(){console.log(`${this} whose to be disposed`)}}class Un{_isOpen;_promise;_completePromise;constructor(){this._isOpen=!1,this._promise=new Promise((t,e)=>{this._completePromise=t})}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}}class Hn extends W{_phase=1;_phaseWhen=new Map;get phase(){return this._phase}set phase(t){if(t<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===t)return;this._phase=t;const e=this._phaseWhen.get(this._phase);e&&(e.open(),this._phaseWhen.delete(this._phase))}async when(t){if(this._phase>=t)return Promise.resolve();let e=this._phaseWhen.get(t);return e||(e=new Un,this._phaseWhen.set(t,e)),e.wait()}}class ds extends W{_shouldRender=!0;shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onFocusPageChange(t){return!1}onCameraChange(t){return!1}onElementChange(t){return!1}onActiveSelectionChange(t){return!1}onHoverObjectChange(t){return!1}onHoverControllerKeyChange(t){return!1}onOperateModeChange(t){return!1}onCursorMove(t){return!1}onCursorStateChange(t){return!1}handleEvents(t){let e=!1;t.forEach(i=>{switch(i.type){case K.ViewFocusPageChange:this.onFocusPageChange(i)&&(e=!0);break;case K.ViewActiveSelectionChange:this.onActiveSelectionChange(i)&&(e=!0);break;case K.ViewCameraChange:this.onCameraChange(i)&&(e=!0);break;case K.ViewElementChange:this.onElementChange(i)&&(e=!0);break;case K.ViewHoverObjectChange:this.onHoverObjectChange(i)&&(e=!0);break;case K.ViewHoverControllerKeyChange:this.onHoverControllerKeyChange(i)&&(e=!0);break;case K.ViewCursorOperateModeChange:this.onOperateModeChange(i)&&(e=!0);break;case K.ViewCursorMove:this.onCursorMove(i)&&(e=!0);break;case K.ViewCursorStateChange:this.onCursorStateChange(i)&&(e=!0);break;default:console.info("View received unknown event: "),console.info(i)}}),e&&(this._shouldRender=!0)}}class lt extends ds{_context;constructor(t){super(),this._context=t,this._context.addViewEventHandler(this)}dispose(){this._context.removeViewEventHandler(this),super.dispose()}}const Yn=s=>{const t=[];for(let e=s.length-1;e>=0;e--){const i=s[e];if(i.visible&&(t.unshift(i),i.opacity===1))break}return t};ms(O.ELLIPSE,Pn);ms(O.RECTANGLE,ge);ls(le.SOLID,Bn);ls(le.IMAGE,Kn);class Wn extends lt{constructor(t,e){super(t),this._getVisibleElementRenderObjects=e}_tempMatrix={a:1,b:0,c:0,d:1,tx:0,ty:0};onElementChange(){return!0}_createClipArea(t,e){const i=Rn(e.type);t.beginPath(),i?.(e,t),t.closePath(),t.clip()}_applyCommonAttrToCtx(t,e){t.globalAlpha=e.opacity}_renderDisplayObject(t,e,i){t.save(),this._applyTransform(t,e,i),this._createClipArea(t,i);const n=Yn(i.getFills());n.length!==0&&(n.forEach(r=>{const o=Dn(r.type);this._applyCommonAttrToCtx(t,r),o(r,t,{contextSize:{width:i.width,height:i.height}})}),t.restore())}onFocusPageChange(){return!0}_applyTransform(t,e,i){const{transform:n}=i;S.multiply(this._tempMatrix,e,n);const{a:r,b:o,c:a,d:h,tx:u,ty:p}=this._tempMatrix;t.setTransform(r,o,a,h,u,p)}render(t,e){const i=this._getVisibleElementRenderObjects();if(i.length===0)return;const n=e.getViewPortMatrix();i.forEach(r=>{this._renderDisplayObject(t,n,r)})}}class At{x=0;y=0;static equals(t,e){return!t&&!e?!0:!!t&&!!e&&t.x===e.x&&t.y===e.y}constructor(t=0,e=0){this.x=t,this.y=e}clone(){return new At(this.x,this.y)}copyFrom(t){this.x=t.x,this.y=t.y}equals(t){return At.equals(this,t)}}const I={CLICK:"click",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",CONTEXT_MENU:"contextmenu",KEY_DOWN:"keydown",KEY_UP:"keyup",DRAG_OVER:"dragover",DROP:"drop"},te=v(0,0);class ps{browserEvent;leftButton;middleButton;rightButton;buttons;button;detail;offsetX;offsetY;ctrlKey;shiftKey;altKey;metaKey;timestamp;constructor(t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.button=t.button,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.offsetX=t.offsetX,this.offsetY=t.offsetY}}class Xn extends ps{dataTransfer;constructor(t){super(t),this.dataTransfer=t.dataTransfer}}class jn extends ps{constructor(t,e,i,n){super(t),this.client=e,this.target=i,this.controllerTargetType=n}}class Gn{constructor(t,e,i){this._viewDom=t,this._client2Viewport=e,this._pickProxy=i}_create(t){te[0]=t.offsetX,te[1]=t.offsetY;const e=this._client2Viewport(te),i=this._pickProxy.pick(e),n=this._pickProxy.pickActiveSelection(e);return new jn(t,{x:e[0],y:e[1]},i,n)}onContextMenu(t){this._viewDom.addEventListener(I.CONTEXT_MENU,e=>{t(this._create(e))})}onMouseUp(t){this._viewDom.addEventListener(I.MOUSE_UP,e=>{t(this._create(e))})}onMouseDown(t){this._viewDom.addEventListener(I.MOUSE_DOWN,e=>{t(this._create(e))})}onPointerDown(t){this._viewDom.addEventListener(I.POINTER_DOWN,e=>{t(this._create(e),e.pointerId)})}onPointerMove(t){this._viewDom.addEventListener(I.POINTER_MOVE,e=>{t(this._create(e),e.pointerId)})}onPointerUp(t){this._viewDom.addEventListener(I.POINTER_UP,e=>{t(this._create(e),e.pointerId)})}onMouseLeave(t){this._viewDom.addEventListener(I.MOUSE_LEAVE,e=>{t(this._create(e))})}onMouseMove(t){this._viewDom.addEventListener(I.MOUSE_MOVE,e=>{t(this._create(e))})}}class Zn{constructor(t,e,i){this.client=e,this.browserEvent=t||null,this.target=t?t.target||t.targetNode||t.srcElement:null,this.deltaY=t.deltaY,this.deltaX=t.deltaX,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.speed=i||this.deltaY}browserEvent;deltaY;deltaX;target;ctrlKey;shiftKey;altKey;metaKey;speed;preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}}const ee=v(0,0);class Ae{static CLEAR_MOUSE_DOWN_COUNT_TIME=400;_altKey;get altKey(){return this._altKey}_ctrlKey;get ctrlKey(){return this._ctrlKey}_metaKey;get metaKey(){return this._metaKey}_shiftKey;get shiftKey(){return this._shiftKey}_leftButton;get leftButton(){return this._leftButton}_rightButton;get rightButton(){return this._rightButton}_targetObject;get targetObject(){return this._targetObject}_lastMouseControllerTarget;get lastMouseControllerTarget(){return this._lastMouseControllerTarget}_lastMouseDownPosition;get lastMouseDownPosition(){return this._lastMouseDownPosition}_lastMouseDownPositionEqualCount;_lastMouseDownCount;_lastSetMouseDownCountTime;constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._rightButton=!1,this._lastMouseDownPosition=void 0,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0}get count(){return this._lastMouseDownCount}setModifiers(t){this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey}setStartButtons(t){this._leftButton=t.leftButton,this._rightButton=t.rightButton}setStartControls(t){this._lastMouseControllerTarget=t.controllerTargetType}setStartTarget(t){this._targetObject=t.target}trySetCount(t,e){const i=new Date().getTime();i-this._lastSetMouseDownCountTime>Ae.CLEAR_MOUSE_DOWN_COUNT_TIME&&(t=1),this._lastSetMouseDownCountTime=i,t>this._lastMouseDownCount+1&&(t=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(e)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=e,this._lastMouseDownCount=Math.min(t,this._lastMouseDownPositionEqualCount)}}class zn{constructor(t,e){this._mouseEvent=t,this._viewController=e,this._mouseEvent.onMouseMove(this._onMouseDownThenMove),this._lastMouseEvent=null}_mouseDownState=new Ae;_isActive=!1;_lastMouseEvent;start(t){this._lastMouseEvent=t,this._mouseDownState.setModifiers(t),this._mouseDownState.setStartButtons(t),this._mouseDownState.trySetCount(t.detail,new At(t.client.x,t.client.y)),this._mouseDownState.setStartControls(t),this._mouseDownState.setStartTarget(t),this._startMonitoring(),this._dispatchMouse(!1,t),this._lastMouseEvent=t}_startMonitoring(){this._isActive=!0}_stopMonitoring(){this._isActive=!1}_onMouseDownThenMove=t=>{this._isActive&&(this._dispatchMouse(!0,t),this._lastMouseEvent=t)};onMouseUp(t){this._mouseDownState.lastMouseDownPosition?.equals(t.client)&&this._mouseDownState.lastMouseControllerTarget===t.controllerTargetType&&this._viewController.setSelectElement(t.target,t.shiftKey),this._stopMonitoring()}isActive(){return this._isActive}_dispatchMouse(t,e){this._viewController.dispatchMouse({target:this._mouseDownState.targetObject,controllerTargetType:this._mouseDownState.lastMouseControllerTarget,position:e.client,startPosition:this._mouseDownState.lastMouseDownPosition,inSelectionMode:t,altKey:this._mouseDownState.altKey,ctrlKey:this._mouseDownState.ctrlKey,metaKey:this._mouseDownState.metaKey,shiftKey:this._mouseDownState.shiftKey,mouseDownCount:this._mouseDownState.count,leftButton:this._mouseDownState.leftButton,rightButton:this._mouseDownState.rightButton,browserEvent:e.browserEvent})}}class Jn{constructor(t,e,i,n){this._view=t,this._viewController=e,this._element=i,this._pickProxy=n,this._mouseEvent=new Gn(this._element,this._view.client2Viewport,this._pickProxy),this._mouseDownOperation=new zn(this._mouseEvent,this._viewController),this._mouseEvent.onMouseDown(this._bindMouseDownHandler),this._mouseEvent.onMouseUp(this._bindMouseUpHandler),this._mouseEvent.onMouseMove(this._bindMouseMoveHandler),this._setupMouseWheelZoomListener()}_isMouseDown;_mouseDownOperation;_mouseEvent;_bindMouseDownHandler=t=>{this._isMouseDown=!0,t.button===0&&this._mouseDownOperation.start(t)};_bindMouseUpHandler=t=>{this._mouseDownOperation.onMouseUp(t),this._isMouseDown=!1,this._viewController.emitMouseUp(t)};_bindMouseMoveHandler=t=>{this._mouseDownOperation.isActive()||this._viewController.dispatchMouse({target:t.target,controllerTargetType:t.controllerTargetType,position:t.client,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,inSelectionMode:!1,mouseDownCount:0,leftButton:t.leftButton,rightButton:t.rightButton,browserEvent:t.browserEvent})};_preventWheelDefault(t){(t.ctrlKey||t.metaKey)&&t.preventDefault()}_setupMouseWheelZoomListener(){let t=null,e=0;const i=r=>(e+=r.deltaY,t||(t=setTimeout(()=>{t=null,e=0},50)),e),n=r=>{ee[0]=r.offsetX,ee[1]=r.offsetY,this._preventWheelDefault(r);const o=this._view.client2Viewport(ee),a=i(r);this._viewController.dispatchWheel(new Zn(r,{x:o[0],y:o[1]},a))};this._element.addEventListener(I.MOUSE_WHEEL,n,{capture:!0,passive:!1})}}class Qn extends lt{_tempMatrix=new S;onCameraChange(){return!0}onElementChange(){return!0}onActiveSelectionChange(){return!0}_renderBorder(t,e){t.strokeStyle="#0B94BF",t.strokeRect(e.x,e.y,e.width,e.height)}_renderControl(t,e){e.getCorners().forEach(n=>{t.fillStyle="#fff",t.beginPath(),t.fillRect(n.x,n.y,n.width,n.height),t.closePath(),this._renderBorder(t,n)})}render(t,e){const i=this._context.getActiveSelection();if(!i.hasActive())return;const n=i.OBB;S.multiply(this._tempMatrix,e.getViewPortMatrix(),n.transform);const{a:r,b:o,c:a,d:h,tx:u,ty:p}=this._tempMatrix;t.setTransform(r,o,a,h,u,p),t.lineWidth=4/e.getZoom(),t.beginPath(),t.strokeStyle="#0B94BF",t.strokeRect(0,0,n.width,n.height),t.closePath(),t.lineWidth=1/e.getZoom(),x.setScale(1/e.getZoom()),this._renderControl(t,i)}}const qn='<image xmlns="http://www.w3.org/2000/svg" id="image0_214_2" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAtBJREFUWEftVj1oGmEYfq4pNqW0tV6NaC2li2RpUUKGDoKik9ChP4OBCJ3cMoQQu0jVFgui6RUzCHYqEuiSFkrtIPgDDXQoNIEOwm1tCBrj0Vr6m/5ceeUOLlc1MZ5kyQuHHxz4Pu/zPO9zH4MDLuaA++MQgJIBOo8IguBmWfYVgL8Afku/Q1NKCeAIgFFBEKIGg2G+2WymjEbjPQDfJSDiMFAoAYwAOJnP530+n2+JmhWLxWcsyz52OBwFANsA/mgNQs3AaQDnRFF8xzAMotEoIpEINjY2Hlqt1rsAvgH4paUsag+cAnB+dXW1ODs7O1apVNoDp1Kp2tzcnLlerz8wm80xLWVRr+EJAJZarbY8NTV1SQZAIGQ2tJZFDWAUgInjuBt2u33B7Xb/J7nWsqgBHAVwNpvNXp+cnIw6HA5jN9PJsjQajQWTyaSUpS+fqgHQKuoBXBBF8S0ZsVfJbJRKpacejycI4Ku0LZQhe6pOHciIVp7nXwSDwYtKH3T6R5fLhXK53H7VarUSer3+jgRi3wDIiObNzc3lTCZzmaZUFjWkovWk89ra2pbFYqkVCoXFQCDwEsBHAD8A7Cm4OjFARhzjOO6m2ogy5dVqdT2Xyy3pdLrtWCz2BsAnAFsABACfB2WgqxFFUUQ4HL4fj8dfS01Jc4pqeuhMQfWzn8TsxEBHIyYSCWFiYqLi9XoXATRIcqkZRTSlI324KKr3RL0sazeb7zAiae33+9+Pj4/fArAuUU3TDvy17AZghxHJcMlk8nYoFHoOoAbgSz8091qHbgDaiZhOp6/NzMxwKysrT5xO5wKAD5L2RLsm1Q0AGZHN5XJXp6enHzEMcwVAXdKeDNeXzvthgIxIPjjD8/y8zWZLSftNK6bpnaBX1pIMxwEck4KFJqcV07R6AaAbkvzQ1AM7vhPy3a7lyvea6a4EshsATeneDwOHAA4ZGDoD/wA5GRIw+FAHtgAAAABJRU5ErkJggg=="/>',$n='<image xmlns="http://www.w3.org/2000/svg" id="image0_214_2" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAHFJREFUWEdjZBhgwDjA9jOMOmA0BIZ8CDRAcxGMJjlTURoC+6E2OpJsM1TDqANGQ2A0BAiFACh/2+PJYg5QuQN41BwEyuEsJwa9AwiVL6MF0WgIjIbAgIfAgDdICJUTBOUJlYQEDaBUwagDRkNgwEMAAC6uFiHehbuXAAAAAElFTkSuQmCC"/>',tr='<image xmlns="http://www.w3.org/2000/svg" id="image0_214_2" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAA7BJREFUWEftVl1MUmEYfk5/StQqKoVwduklicKQKZhTu2j9uJZza14fdbMfsi11a5Xk5gpbNwqXaX/D5rqJtMydiVviucB50ZpXEYQVHstypf2d9rrDxgo4iLRu+jYGHD7e93mf93mf72Pwjxfzj/PjP4D/DGSKgXUA1gMrmvoJ4AcAMRWBZwLABgDZgiBcUKlU56anp4/odLonAJYlMElxrBUAJd8cDAYv5+XlnWpqaprt6enReL3e4xaLxQNgSQ7EWgCsJA8EAh35+fknjUbjF57nFSzLvnM6nTmpglgLAMXs7KxdrVbbjEYjVUqL4ol6vf4jgZiamjpaWFj4CMDXRH1IFwD9TwkgNxKJ3B8dHSXaFT6fL2tycjJrYGDgTUFBwUOdTncRwJzUirgY0gVAwRQAdgPYGwwGnR0dHWp66HK5VOPj4/fKysquAQgBeP83GKBcpIHtALRer/d8c3PzYdJBbW0tV1lZeQPAawARAJ+lscw4A8TeFgB7RFF8wTAMRFGEz+e7ZTKZ7ADeAviULHlUNKn4Rbw9ZDzbZmZm7A6H45jL5cohAAzDlAAIABCSUR8NmK4GyPkUw8PDh6qrq+9S9SzLztXX1z8uLS2l6ol+ql7WDZMBSGSv9Dyb47iDVqvV3djYGBFFkXE6nbsYhikD8FLqPTmh7EoEIJ69PpX6uYnjuAOUvKGh4V2U+omJidslJSWdAMIAPso5YLIWrDhcKBS6pNVqT0ft1ePxnFAqld+Ki4vPDg0Nabu6unaS8bS0tCxoNBrOYrFcB/AKwLx0DshWH0+Ef9hrUVHRYm9v726O4yAIQogSS5Y7R7SPjY25rVYrjR1VTqZDY0cnYkortgX0WREOh+0ajeYM2SvP89kGg2GZ5/ksimYwGJb0ev1iRUXFD7PZLPT3999ua2sblUaOVE/Jv6eUOca7o/tJXFsHBweP1NTU3GRZVvD7/VtsNhupGXV1dbvoPRQKPe/r67vT3t7+TKKbql6QM5xUzgICQMaidjgch20221WWZef9fr+S/H1kZORBVVVVP4APMS8SG1VNiqdLyKrX7y0gqneQu3V2dh5obW294na73+bm5o6Vl5c7JXOhahcBfJGMhiiXnfdUGKA9KzMOQAUgp7u7e7/ZbN5nMpl6pNmmg4Uq/raaa1cyWuL5QBTENqkl9J2SRvu8KpHJ9SSREVHSTQA2SpcMqpguFWn1ebUMxJpUFCD1OO0+pwtAjr2M/J7uaZiR5PGsOGOBUw30C7AWYjCXaOrKAAAAAElFTkSuQmCC"/>',er='<image xmlns="http://www.w3.org/2000/svg" id="image0_214_2" width="32" height="32" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAlJJREFUWEftlU2IEnEYxh/b3dSKIj8QySSQgpYVmpMQzOxF8KBEdFhi0MNcBC+dOmlsEKEdFmTB8BB48CAdOog4s8ImJskePEmHDkWQsGoyFkGWfTrxlxGWxZmd3T24hxmYwzDvn/f3PvO8zxgw58sw5/7QAXQFdAV0BU68AosAFvr9/qrD4XgF4C+AsUp6LgBYlOvrcv0/tbRVU2AJwJnRaCSYTKabrVbrNkVR2wB+KkAQWLMoius2m+3+YDDYsNvtjwD8AKAIoQRAmp8bDodb4XB4SZIkQ7FYpKrV6l2/3/8SwB8A0p7JTgEwttvthNvtvme1Wt9nMpkxwzBbLpdrXQ1iFgCZhDSvsCxrLJVKN/L5/MdIJHJF648rFAq95Xl+uVAovGMYRlCDmAVg7vV6j2u1Wohl2WtamyrVSZKEZrN5x+fzCQB+7a/bD0CezwJwiKL4guM4Y7lcvp7L5Tocx13SChMMBj8IguAhynm93hpFUQ8BDACMDgIg780ArAAudzqdZ9FodOIBnuevxuPxJ6lU6o3s7r0eIOCnK5XKWiAQuGWxWHbT6fTY4/Hs0DS9AWAXwFctChCAiQcA2AE4u93uU6fTuZJMJh8kEonXAL4B+D3DhCYAF+r1epRhmLVGo/GcpulNAJ8AfFYyouoWyEpczGazvlgs1pCnIAAztwDAeQDT+h258ZfDbsH0M01yQL6JKmT/vx+UA7KHyFmiEsmAI+XAFGKShADInpMw0ZSEcj1JTFJ/5CTUavpj1Z34n9GxptNyWFdAV0BXYO4K/Ada+ckhCh3WlQAAAABJRU5ErkJggg=="/>';function bt(s,t,e,i,n,r=16,o=16){const a=(-e-t)*(Math.PI/180),h=Math.sin(a),u=Math.cos(a),p=1*u-1*h,f=1*h+1*u;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${n};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${p}' dy='${f}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+e} 16 16)${i?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>${s.replaceAll('"',"'")}</g></svg>") ${r} ${o}, pointer`}const st={default:(s,t,e)=>bt(qn,s,0,t,e),readonly:()=>getComputedStyle(document.documentElement).getPropertyValue("--cursor-readonly"),add:(s,t,e)=>bt($n,s,0,t,e),resize:(s,t,e)=>bt(er,s,0,t,e,15,15),rotate:(s,t,e)=>bt(tr,s,0,t,e)};class sr extends lt{constructor(t,e){super(t),this._renderDOM=e,this._renderDOM.className="latte-cursor"}_tempMatrix=new S;onOperateModeChange(t){const{mode:e}=t;switch(e){case N.Edit:this._renderDOM.style.setProperty("--cursor-editor",st.default(0,0,0));break;case N.CreateNormalShape:this._renderDOM.style.setProperty("--cursor-editor",st.add(0,0,0));break;case N.ReadOnly:this._renderDOM.style.setProperty("--cursor-editor",st.readonly());break;default:on()}return!1}onHoverObjectChange(t){return!0}_setRotateCursor(t){let e=0;switch(t){case T.SELECT_ROTATE_LEFT_BOTTOM:e=90;break;case T.SELECT_ROTATE_LEFT_TOP:e=180;break;case T.SELECT_ROTATE_RIGHT_TOP:e=270;break;default:e=0;break}this._renderDOM.style.setProperty("--cursor-editor",st.rotate(e,0,0))}_setResizeCursor(t){let e=0;switch(t){case T.SELECT_RESIZE_RIGHT_BOTTOM:e=45;break;case T.SELECT_RESIZE_BOTTOM:e=90;break;case T.SELECT_RESIZE_LEFT_BOTTOM:e=135;break;case T.SELECT_RESIZE_LEFT:e=180;break;case T.SELECT_RESIZE_LEFT_TOP:e=225;break;case T.SELECT_RESIZE_TOP:e=270;break;case T.SELECT_RESIZE_RIGHT_TOP:e=315;break;default:e=0;break}this._renderDOM.style.setProperty("--cursor-editor",st.resize(e,0,0))}onHoverControllerKeyChange(t){const{controllerKey:e}=t;return $e(e)?this._setRotateCursor(e):ts(e)?this._setResizeCursor(e):this._renderDOM.style.setProperty("--cursor-editor",st.default(0,0,0)),!1}render(t,e){const i=this._context.getCursorHoverObject();if(!i)return;const{OBB:n}=i;S.multiply(this._tempMatrix,e.getViewPortMatrix(),n.transform);const{a:r,b:o,c:a,d:h,tx:u,ty:p}=this._tempMatrix;t.setTransform(r,o,a,h,u,p),t.lineWidth=4/e.getZoom(),t.beginPath(),t.strokeStyle="#0B94BF",t.strokeRect(0,0,n.width,n.height),t.closePath()}}let it,se;const ir=s=>s instanceof F&&!(s instanceof ue)&&!(s instanceof wt);class nr{constructor(t){this._viewModel=t}addSelectElement(t){t instanceof F&&this._viewModel.addSelectElement(t)}removeSelectElement(t){t instanceof F&&this._viewModel.removeSelectElement(t)}_moveSelectionElement(t){if(!it)return;const e=R(t,it),i=this._viewModel.onElementWillMove(e),n=this._viewModel.getActiveSelection();as.runCoreEditorCommand(this._viewModel,{objects:n.getObjects(),position(r){return Z(r,i)}})}_rotateSelectionElement(t){if(!it)return;const e=this._viewModel.getActiveSelection(),i=e.getCenter(),n=R(it,i),r=R(t,i),o=Math.atan2(r[1],r[0])-Math.atan2(n[1],n[0]);fn.runCoreEditorCommand(this._viewModel,{objects:e.getObjects(),rad:o,transformOrigin:i})}_resizeElement(t,e){cs.runCoreEditorCommand(this._viewModel,{key:t,position:e})}_createPickArea(t){Pe.runCoreEditorCommand(this._viewModel,{startPosition:se,position:t})}setSelectElement(t,e){_n.runCoreEditorCommand(this._viewModel,{target:t,multipleMode:e})}emitMouseUp(t){this._viewModel.getModel().pushStackElement(),this._viewModel.getCursorOperateMode()===N.CreateNormalShape&&(this._viewModel.getActiveSelection().isActive()||this._createElement({startPosition:v(t.client.x,t.client.y),target:t.target}),this._viewModel.setCursorOperateMode(N.Edit)),this._viewModel.onElementMoveEnd(),Pe.runCoreEditorCommand(this._viewModel,{})}emitDrop(t,e){this._viewModel.getModel().pushStackElement();const i=t.map(n=>Is(n));Be.runCoreEditorCommand(this._viewModel,{startPosition:q(e),paint:i})}_dragOnClientToEdit(t,e){e===T.SELECTION_CONTEXT?this._moveSelectionElement(t):$e(e)?this._rotateSelectionElement(t):ts(e)?this._resizeElement(e,t):e===T.NONE&&this._createPickArea(t)}_dragOnClient(t){const e=this._viewModel.getCursorOperateMode();if(e===N.ReadOnly){const{browserEvent:i}=t,n=i.movementX,r=i.movementY,o=this._viewModel.getCamera(),a=o.getViewPortMatrix();o.move(-n/a.a,-r/a.d)}else e===N.Edit?this._dragOnClientToEdit(q(t.position),t.controllerTargetType):e===N.CreateNormalShape&&this._createElement({startPosition:q(t.startPosition),target:t.target,position:q(t.position)});this._viewModel.onElementDidMove()}_mouseDownOnClient(t){const{target:e,controllerTargetType:i,shiftKey:n}=t;switch(i){case T.BLANK:case T.NONE:this.setSelectElement(e,n);break;default:console.error("UnExpect type")}}_createElement(t){const{startPosition:e,position:i,target:n}=t;let r=n;for(;!(r instanceof ct);)r=n.parentNode;(!r||r instanceof wt)&&(r=this._viewModel.focusPage);const o=r.getLast();Be.runCoreEditorCommand(this._viewModel,{position:i,startPosition:e,parent:JSON.parse(r.id),insertAfter:o.zIndex})}dispatchMouse(t){if(t.mouseDownCount===1)t.inSelectionMode?this._dragOnClient(t):this._mouseDownOnClient(t);else{if(this._viewModel.getCursorOperateMode()!==N.Edit)return;const{target:i,controllerTargetType:n}=t;this._viewModel.setCursorHoverObject(ir(i)?i:null),this._viewModel.setCursorHoverControllerKey(n)}it=q(t.position,it),se=q(t.startPosition,se)}dispatchWheel(t){const e=this._viewModel.getCamera(),{deltaY:i,deltaX:n,client:r}=t;if(!t.ctrlKey&&!t.metaKey){e.move(n,i);return}const o=e.getZoom(),a=.04*t.speed/100;e.setZoom(o/(1+a),v(r.x,r.y))}}class rr extends lt{onCursorMove(t){return!0}render(t,e){const i=this._context.getBoxSelectBounds();if(i.isEmpty())return;const{x:n,y:r,width:o,height:a}=i.getRectangle(),{a:h,b:u,c:p,d:f,tx:g,ty:w}=e.getViewPortMatrix();t.setTransform(h,u,p,f,g,w),t.fillStyle="#00CCFF",t.globalAlpha=.3,t.fillRect(n,r,o,a)}}const or=["image/png","image/jpeg","image/webp"],ar=256,cr=.02;class hr{constructor(t,e,i){this._renderDOM=t,this._client2Viewport=e,this._viewContainer=i,this._renderDOM.addEventListener(I.DRAG_OVER,this._stopPropagationAndDefault.bind(this)),this._renderDOM.addEventListener(I.DROP,this._handleDrag.bind(this))}_verifyFileType(t){return or.includes(t.type)}_stopPropagationAndDefault(t){t.stopPropagation(),t.preventDefault()}async _handleUploadFile(t){return Ee.load(t)}async _handleUploadFiles(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];this._verifyFileType(n)&&e.push(await this._handleUploadFile(n))}return e.sort((i,n)=>i.name.localeCompare(n.name))}async _handleDrag(t){this._stopPropagationAndDefault(t);const{dataTransfer:e}=t;if(!e)return;const{files:i}=e,n=await this._handleUploadFiles(i);new Xn(t);const r=this._client2Viewport({x:t.offsetX,y:t.offsetY});this._viewContainer.emitDrop(n,r)}}const Kt=(s,t)=>{if(t.length<=1)return;s.beginPath();const e=t[0];s.moveTo(e[0],e[1]);for(let i=1;i<t.length;i++){const n=t[i];s.lineTo(n[0],n[1])}s.closePath(),s.stroke()},Ve=(s,t,e,i)=>{const n=[t-i/2,e-i/2],r=[t+i/2,e-i/2],o=[t-i/2,e+i/2],a=[t+i/2,e+i/2];Kt(s,[n,a]),Kt(s,[r,o])},lr=s=>{const t=s[0],e=[];for(let i=1;i<s.length;i++)e.push(v(t,s[i]));return e},ur=s=>{const t=s[0],e=[];for(let i=1;i<s.length;i++)e.push(v(s[i],t));return e};class mr extends lt{_adsorptionPoints={x:[],y:[]};onCursorStateChange(t){const{adsorptionPoints:e}=t.state;return this._adsorptionPoints=e,!0}render(t,e){const i=this._adsorptionPoints;if(i.x.length<1&&i.y.length<1)return;const{a:n,b:r,c:o,d:a,tx:h,ty:u}=e.getViewPortMatrix();t.setTransform(n,r,o,a,h,u),t.lineWidth=2,t.strokeStyle="red";const{x:p,y:f}=i,g=lr(p),w=ur(f);if(g.length){for(let A=0;A<g.length;A++){const M=g[A];Ve(t,M[0],M[1],4)}Kt(t,g)}if(w.length){for(let A=0;A<w.length;A++){const M=w[A];Ve(t,M[0],M[1],4)}Kt(t,w)}}}class dr extends lt{onCameraChange(t){return t.camera.getZoom()>=8}_renderGrid(t,e){const i=e.getZoom();if(i<8)return;const{a:n,b:r,c:o,d:a,tx:h,ty:u}=e.getViewPortMatrix();t.setTransform(n,r,o,a,h,u);const{x:p,y:f,width:g,height:w}=e.getViewport();let A=Math.ceil(p);const M=p+g;let E=Math.ceil(f);const y=f+w;for(t.lineWidth=1/i;A<=M;)t.strokeStyle="#cccccc55",t.beginPath(),t.moveTo(A,f),t.lineTo(A,w),t.stroke(),t.closePath(),A+=1;for(;E<=y;)t.strokeStyle="#cccccc55",t.beginPath(),t.moveTo(p,E),t.lineTo(g,E),t.stroke(),t.closePath(),E+=1;t.save()}render(t,e){this._renderGrid(t,e)}}class pr extends ds{constructor(t,e,i){super(),this._viewModel=t,this._renderService=e,this._renderDOM=i,this.client2Viewport=this.client2Viewport.bind(this),this._viewController=new nr(this._viewModel),this._renderElement=new Wn(this._viewModel,this._viewModel.getVisibleElementRenderObjects),this._viewParts.push(this._renderElement),this._viewCursor=new sr(this._viewModel,this._renderDOM),this._viewParts.push(this._viewCursor),this._selectBox=new Qn(this._viewModel),this._viewParts.push(this._selectBox),this._viewAdsorptionLine=new mr(this._viewModel),this._viewParts.push(this._viewAdsorptionLine),this._viewGrid=new dr(this._viewModel),this._viewParts.push(this._viewGrid),this._mouseHandler=new Jn(this,this._viewController,this._renderDOM,this._viewModel.pickProxy),this._pickArea=new rr(this._viewModel),this._viewParts.push(this._pickArea),this._dragHandler=new hr(this._renderDOM,this.client2Viewport,this._viewController)}_renderElement;_mouseHandler;_dragHandler;_selectBox;_viewCursor;_viewParts=[];_viewController;_pickArea;_viewAdsorptionLine;_viewGrid;render(){this._scheduleRender()}getCamera(){return this._viewModel.getCamera()}_getViewPartsToRender(){const t=[];let e=0;return this._viewParts.forEach(i=>{i.shouldRender()&&(t[e++]=i)}),t}_scheduleRender(){requestAnimationFrame(()=>{this._actualRender(),this._scheduleRender()})}_actualRender(){if(this._getViewPartsToRender().length===0)return;const e=this.getCamera();this._renderService.prepareRender(e);const i=this._renderService.getCanvasRenderingContext();this._viewParts.forEach(n=>{n.render(i,e),n.onDidRender()})}client2Viewport(t){const i=this.getCamera().getViewPortMatrix();return S.applyMatrixInvertToPoint(i,t)}viewport2Client(t){const i=this.getCamera().getViewPortMatrix();return S.apply(t,i)}dispose(){for(const t of this._viewParts)t.dispose();super.dispose()}}class _r{constructor(t){this._canvas=t,this._ctx=this._canvas.getContext("2d")}_ctx;getCanvasRenderingContext(){return this._ctx}prepareRender(t){this._ctx.resetTransform(),this._clearDrawArea();const e=t.getViewPortMatrix();this._ctx.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty)}_clearDrawArea(t={x:0,y:0,width:this._canvas.width,height:this._canvas.height}){const e=this._ctx;e.resetTransform(),this._canvas.width=t.width,this._canvas.height=t.height,e.clearRect(t.x,t.y,t.width,t.height),e.fillStyle=Si,e.fillRect(0,0,t.width,t.height)}}class fr{_zoom=1;_physicalViewport;_position;_matrix=new S;constructor(t,e=1){this._physicalViewport={...t},this._setZoomValue(e),this._position=new At(t.width/2,t.height/2)}_onCameraViewChange=new D;onCameraViewChange=this._onCameraViewChange.event;setZoom(t,e){const i=this._matrix.clone();this._setZoomValue(t)&&(e?this._adjustPosition(i,e):this._updateMatrix())}_setZoomValue(t){const e=Math.min(Math.max(t,cr),ar);return e===this._zoom?!1:(this._zoom=e,!0)}_adjustPosition(t,e){const i=S.applyMatrixInvertToPoint(this._matrix,S.apply(e,t)),n=R(i,e);this.move(-n[0],-n[1])}_updateMatrix(){const t=this._physicalViewport.width/2-this._position.x*this._zoom,e=this._physicalViewport.height/2-this._position.y*this._zoom;this._matrix.a=1*this._zoom,this._matrix.b=0,this._matrix.c=0,this._matrix.d=1*this._zoom,this._matrix.tx=t,this._matrix.ty=e,this._onCameraViewChange.fire(this)}move(t,e){this._position.x+=t,this._position.y+=e,this._updateMatrix()}setPosition(t,e){this._position.x=t,this._position.y=e,this._updateMatrix()}getViewPortMatrix(){return this._matrix}getViewport(){const t=this._position.x,e=this._position.y,i=this._physicalViewport.width/this._zoom,n=this._physicalViewport.height/this._zoom;return{x:t-i/2,y:e-n/2,width:i,height:n}}getZoom(){return this._zoom}}class yr extends W{constructor(t){super(),this.fullSize=t}_cameraMaps=new Map;_onCameraViewChange=new D;onCameraViewChange=this._onCameraViewChange.event;createCamera(t,e){const{fullSize:i}=this,{size:n,padding:r=0}=e,{width:o,height:a}=n,{width:h,height:u}=i,p=h*(1-r)/o,f=u*(1-r)/a,g=Math.min(p,f),w=n.x+o/2,A=n.y+a/2,M=new fr(i,g);return M.setPosition(w,A),this._cameraMaps.set(t,M),M.onCameraViewChange(this._listCameraViewChange),M}_listCameraViewChange=t=>{this._onCameraViewChange.fire(t)};getViewport(t){if(!this._cameraMaps.has(t))throw Error(`can not found camera by id: ${t}`);return this._cameraMaps.get(t).getViewport()}getCamera(t){if(!this._cameraMaps.has(t))throw Error(`can not found camera by id: ${t}`);return this._cameraMaps.get(t)}dispose(){this._cameraMaps.clear(),super.dispose()}}class gr extends W{constructor(t){super(),this._domElement=t,this._initDOMSize(),this._initEventListener()}_domCacheWidth;_domCacheHeight;_onDOMWheel=new D;onDOMWheel=this._onDOMWheel.event;_onResize=new D;onResize=this._onResize.event;get canvasSize(){return{width:this._domCacheWidth,height:this._domCacheHeight}}_updateSizeCache(){const t=this._domElement.getBoundingClientRect();this._domCacheWidth=t.width,this._domCacheHeight=t.height}_initDOMSize(){this._updateSizeCache()}_initEventListener(){this._domElement.addEventListener("wheel",this._onDOMWheel.fire),this._domElement.addEventListener("resize",this._onResize.fire)}dispose(){this._domElement.removeEventListener("wheel",this._onDOMWheel.fire),this._domElement.removeEventListener("resize",this._onResize.fire),super.dispose()}}class Er extends W{_onWillExecuteCommand=new D;onWillExecuteCommand=this._onWillExecuteCommand.event;_onDidExecuteCommand=new D;onDidExecuteCommand=this._onDidExecuteCommand.event;executeCommand(t,...e){return this._tryExecuteCommand(t,e)}_tryExecuteCommand(t,e){const i=fe.getCommand(t);if(!i)return Promise.reject(new Error(`command '${t}' not found`));try{this._onWillExecuteCommand.fire({commandId:t,args:e});const n=i.handler.call(null,...e);return this._onDidExecuteCommand.fire({commandId:t,args:e}),Promise.resolve(n)}catch(n){return Promise.reject(n)}}}function Ar(s){if(s.charCode){const e=String.fromCharCode(s.charCode).toUpperCase();return zi(e)}const{keyCode:t}=s;if(t===3)return C.PauseBreak;if(cn)switch(t){case 59:return C.Semicolon;case 60:if(an)return C.IntlBackslash;break;case 61:return C.Equal;case 107:return C.NumpadAdd;case 109:return C.NumpadSubtract;case 173:return C.Minus;case 224:if(gt)return C.Meta;break}else if(hn&&(gt&&t===93||!gt&&t===92))return C.Meta;return es[t]||C.Unknown}const wr=gt?Y.WinCtrl:Y.CtrlCmd,vr=Y.Alt,Mr=Y.Shift,Sr=gt?Y.CtrlCmd:Y.WinCtrl;class _s{_standardKeyboardEventBrand=!0;browserEvent;target;ctrlKey;shiftKey;altKey;metaKey;altGraphKey;keyCode;code;_asKeybinding;_asKeyCodeChord;constructor(t){const e=t;this.browserEvent=e,this.target=e.target,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.metaKey=e.metaKey,this.altGraphKey=e.getModifierState?.("AltGraph"),this.keyCode=Ar(e),this.code=e.code,this.ctrlKey=this.ctrlKey||this.keyCode===C.Ctrl,this.altKey=this.altKey||this.keyCode===C.Alt,this.shiftKey=this.shiftKey||this.keyCode===C.Shift,this.metaKey=this.metaKey||this.keyCode===C.Meta,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(t){return this._asKeybinding===t}_computeKeybinding(){let t=C.Unknown;this.keyCode!==C.Ctrl&&this.keyCode!==C.Shift&&this.keyCode!==C.Alt&&this.keyCode!==C.Meta&&(t=this.keyCode);let e=0;return this.ctrlKey&&(e|=wr),this.altKey&&(e|=vr),this.shiftKey&&(e|=Mr),this.metaKey&&(e|=Sr),e|=t,e}_computeKeyCodeChord(){let t=C.Unknown;return this.keyCode!==C.Ctrl&&this.keyCode!==C.Shift&&this.keyCode!==C.Alt&&this.keyCode!==C.Meta&&(t=this.keyCode),new at(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,t)}}var Pt=(s=>(s[s.NoMatchingKb=0]="NoMatchingKb",s[s.MoreChordsNeeded=1]="MoreChordsNeeded",s[s.KbFound=2]="KbFound",s))(Pt||{});const Fe={kind:0},Cr={kind:1};function xr(s,t){return{kind:2,commandId:s,commandArgs:t}}class br{_keybindings;_map;_lookupMap;constructor(t){this._keybindings=t,this._map=new Map,this._lookupMap=new Map;for(let e=0,i=this._keybindings.length;e<i;e++){const n=this._keybindings[e];n.chords.length!==0&&this._addKeyPress(n.chords[0],n)}}_addKeyPress(t,e){const i=this._map.get(t);if(typeof i>"u"){this._map.set(t,[e]),this._addToLookupMap(e);return}for(let n=i.length-1;n>=0;n--){const r=i[n];if(r.command===e.command)continue;let o=!0;for(let a=1;a<r.chords.length&&a<e.chords.length;a++)if(r.chords[a]!==e.chords[a]){o=!1;break}}i.push(e),this._addToLookupMap(e)}_addToLookupMap(t){if(!t.command)return;let e=this._lookupMap.get(t.command);typeof e>"u"?(e=[t],this._lookupMap.set(t.command,e)):e.push(t)}resolve(t,e){const i=[...t,e],n=this._map.get(i[0]);if(n===void 0)return Fe;let r=null;if(i.length<2)r=n;else{r=[];for(let a=0,h=n.length;a<h;a++){const u=n[a];if(i.length>u.chords.length)continue;let p=!0;for(let f=1;f<i.length;f++)if(u.chords[f]!==i[f]){p=!1;break}p&&r.push(u)}}if(!r.length)return Fe;const o=r[0];return i.length<o.chords.length?Cr:xr(o.command,o.commandArgs)}}class Tr extends W{constructor(t){super(),this._commandService=t,this._registerKeyListeners(),this._currentlyDispatchingCommandId=null}_currentChords=[];_cacheResolver;_currentlyDispatchingCommandId;get inChordMode(){return this._currentChords.length>0}_keyListener=t=>{const e=new _s(t);this._dispatch(e)};_registerKeyListeners(){window.addEventListener(I.KEY_DOWN,this._keyListener)}_dispatch(t){this._doDispatch(this.resolveKeyboardEvent(t))}_leaveChordMode(){this._currentChords=[]}_doDispatch(t){let e=null,i=null;if([e]=t.getDispatchChords(),i=this._currentChords.map(({keypress:r})=>r),e===null)return;const n=this._getResolver().resolve(i,e);switch(n.kind){case Pt.NoMatchingKb:return this.inChordMode&&this._leaveChordMode(),!1;case Pt.MoreChordsNeeded:return this._currentChords.push({keypress:e}),!1;case Pt.KbFound:{if(n.commandId===null||n.commandId==="")this.inChordMode&&this._leaveChordMode();else{this.inChordMode&&this._leaveChordMode(),this._currentlyDispatchingCommandId=n.commandId;try{typeof n.commandArgs>"u"?this._commandService.executeCommand(n.commandId).then(void 0,r=>console.error):this._commandService.executeCommand(n.commandId,n.commandArgs).then(void 0,console.error)}finally{this._currentlyDispatchingCommandId=null}}return!1}}}_resolveChord(t){if(!t)return null;const{ctrlKey:e,shiftKey:i,altKey:n,metaKey:r,keyCode:o}=t;return new at(e,i,n,r,o)}resolveKeyboardEvent(t){const{ctrlKey:e,shiftKey:i,altKey:n,metaKey:r,keyCode:o}=t,a=new at(e,i,n,r,o);return new Re([a])}_resolveKeybindings(t){const e=rs(t.chords.map(i=>this._resolveChord(i)));return e.length>0?[new Re(e)]:[]}_resolveKeybindingItems(t){const e=[];let i=0;return t.forEach(n=>{const{keybinding:r}=n;let o=[void 0];r&&(o=this._resolveKeybindings(r)),o.forEach(a=>{e[i++]=new un(a,n.command,n.commandArgs)})}),e}_getResolver(){if(!this._cacheResolver){const t=this._resolveKeybindingItems(os.getDefaultKeybindings());this._cacheResolver=new br(t)}return this._cacheResolver}dispose(){this._cacheResolver=null,window.removeEventListener(I.KEY_DOWN,this._keyListener),super.dispose()}}const ie={"editor.canvasGrid.strokeColor":"#cccccc55","editor.canvasGrid.showZoom":"8"};function fs(s,t,e,i){const n=t.split("."),r=n.pop();let o=s;for(let a=0;a<n.length;a++){const h=n[a];let u=o[h];switch(typeof u){case"undefined":o[h]=Object.create(null),u=o[h];break;case"object":break;default:i(`Ignoring ${t} as ${n.slice(0,a+1).join(".")} is ${JSON.stringify(u)}`);return}o=u}if(typeof o=="object"&&o!==null)try{o[r]=e}catch{i(`Ignoring ${t} as ${n.join(".")} is ${JSON.stringify(o)}`)}else i(`Ignoring ${t} as ${n.join(".")} is ${JSON.stringify(o)}`)}function ys(s,t){const e=t.shift();if(t.length===0){delete s[e];return}if(Object.keys(s).indexOf(e)!==-1){const i=s[e];typeof i=="object"&&!Array.isArray(i)&&(ys(i,t),Object.keys(i).length===0&&delete s[e])}}function Ir(s,t,e){function i(o,a){let h=o;for(const u of a){if(typeof h!="object"||h===null)return;h=h[u]}return h}const n=t.split("."),r=i(s,n);return typeof r>"u"?e:r}function Or(s,t){const e=t.split(".");ys(s,e)}class Dr{constructor(t={},e=[]){this._contents=t,this._keys=e}setValue(t,e){this._addKey(t),fs(this._contents,t,e,i=>{throw new Error(i)})}removeValue(t){this._removeKey(t)&&Or(this._contents,t)}_addKey(t){let e=this._keys.length;for(let i=0;i<e;i++)t.indexOf(this._keys[i])===0&&(e=i);this._keys.splice(e,1,t)}_removeKey(t){const e=this._keys.indexOf(t);return e!==-1?(this._keys.splice(e,1),!0):!1}getValue(t){return t?Ir(this._contents,t):this._contents}}class Rr extends Dr{constructor(){const t={},e=Object.keys(ie);for(const i in ie){const n=ie[i];fs(t,i,n,r=>console.error(`Conflict in default settings: ${r}`))}super(t,e)}}class Pr extends W{_defaultConfiguration;constructor(){super(),this._defaultConfiguration=new Rr}getValue(t){return this._defaultConfiguration.getValue(t)}}class Br{_view;_container;constructor(t){this._view=document.createElement("div"),this._view.className="context-view",t.appendChild(this._view)}setContainer(t){this._container.removeChild(this._view),this._container=t,this._container.appendChild(this._view)}hide(){this._view.style.display="none",this._view.innerHTML=""}show(t){this.hide(),this._view.style.display="block",this._view.style.left="0px",this._view.style.top="0px",this._view.style.position="absolute",t.render(this._view),t.onFocus?.()}}class J{static join(...t){let e=[];for(const i of t)i.length&&(e.length?e=[...e,new J,...i]:e=i);return e}static ID="latte.actions.separator";id=J.ID;label="";tooltip="";class="separator";enabled=!1;checked=!1;async run(){}}class Nr{constructor(t,e){this._commandService=e,this.action=t}action;_context;_element;setActionContext(t){this._context=t}render(t){this._element=t,this._element.classList.add("action-view-item"),t.textContent=this.action.label,this.action.id===J.ID&&this._element.classList.add("separator"),this._bindEvent()}_bindEvent(){this._element?.addEventListener(I.CLICK,t=>{this.isEnabled()&&(this.run(),t.stopPropagation())}),this._element?.addEventListener(I.KEY_DOWN,t=>{this.focus()}),this._element?.addEventListener(I.KEY_UP,t=>{this.blur()}),this._element?.addEventListener(I.MOUSE_OUT,t=>{this.blur()})}focus(){this._element?.focus(),this._element?.classList.add("focused")}blur(){this._element?.classList.remove("focused")}isEnabled(){return this.action.enabled}run(){return console.log(this),this._commandService.executeCommand(this.action.id)}}class Lr{viewItems=[];_domNode;_focusItem;_actionList=document.createElement("ul");constructor(t,e){this._domNode=document.createElement("div"),this._domNode.className="action-bar",this._actionList=document.createElement("ul"),this._actionList.className="action-list",this._domNode.appendChild(this._actionList),t.appendChild(this._domNode),this.push(e),this._onMouseOver(),document.body.addEventListener(I.KEY_DOWN,i=>{if(!this.viewItems.length)return;const n=new _s(i);n.equals(C.DownArrow)?this._focusNext():n.equals(C.UpArrow)?this._focusPrevious():n.equals(C.Home)?this._focusFirst():n.equals(C.End)?this._focusLast():n.equals(C.Enter)&&this._doTrigger()})}_focusLast(){this._updateFocus(this.viewItems.length-1)}_focusFirst(){this._updateFocus(0)}_focusNext(){let t=this._focusItem;typeof t>"u"&&(t=-1);let e=t+1;for(e>=this.viewItems.length&&(e=0);this.viewItems[e]?.action.id===J.ID;)e++;this._updateFocus(e)}_focusPrevious(){let t=this._focusItem;typeof t>"u"&&(t=this.viewItems.length);let e=t-1;for(e<0&&(e=this.viewItems.length-1);this.viewItems[e]?.action.id===J.ID;)e--;this._updateFocus(e)}_onMouseOver(){this._actionList.addEventListener(I.MOUSE_MOVE,t=>{const e=t.target,i=Array.from(this._actionList.children).findIndex(n=>n===e);i!==-1&&this._updateFocus(i)})}_updateFocus(t){if(this._focusItem===t)return;const e=this._focusItem?this.viewItems[this._focusItem]:void 0;if(this._focusItem=t,e?.action.id===J.ID){this._focusItem=void 0;return}e?.blur(),typeof this._focusItem=="number"&&this.viewItems[this._focusItem].focus()}_doTrigger(){this.viewItems[this._focusItem]?.run()}push(t){t.forEach(e=>{const i=document.createElement("li");i.className="action-view-item",this._actionList.appendChild(i);const n=new Nr(e);n.render(i),this.viewItems.push(n)}),this._domNode.focus()}}class Vr{_view;_contextView;constructor(){this._view=document.querySelector(".context-view"),this._view||(this._view=document.createElement("ul"),document.body.appendChild(this._view),this._view.className="context-view-container"),this._contextView=new Br(this._view)}showContextMenu(t){const e=t.getAnchor();this._view.style.display="block",this._view.style.left=`${e.x}px`,this._view.style.top=`${e.y}px`,this._contextView.show({render:i=>{const n=t.getActions();new Lr(i,n),window.addEventListener(I.MOUSE_DOWN,r=>{let o=r.target;for(;o;){if(o===this._view)return;o=o.parentElement}this.hideContextView()}),window.addEventListener(I.CLICK,r=>{this.hideContextView()})},onFocus:()=>{}})}hideContextView(){this._contextView.hide()}}class Fr{_contextViewService;_onDidHideMenu=new D;_onDidFocusMenu=new D;constructor(){this._contextViewService=new Vr}showContextMenu(t){this._contextViewService.showContextMenu({...t,onHide:()=>this._onDidHideMenu.fire(),onFocus:()=>this._onDidFocusMenu.fire()})}}class kr{constructor(t){this.item=t,this.id=t.command.id,this.label=t.command.title||t.command.id,this.tooltip=t.command.tooltip||""}id;label;tooltip;enabled=!0;_commandService;run(t){return this._commandService.executeCommand(this.id)}}class Kr extends W{constructor(t){super(),this._menuId=t}_onDidChange=new D;_menuGroups=[];refresh(){this._menuGroups.length=0;const t=pe.getMenuItems(this._menuId);t.sort((i,n)=>i.group&&n.group?i.group.localeCompare(n.group):i.group?-1:n.group?1:-1);let e;for(const i of t){const n=i.group||"";(!e||e[0]!==n)&&(e=[n,[]],this._menuGroups.push(e)),e[1].push(i)}}onDidChange=this._onDidChange.event;getActions(){this.refresh();const t=[];for(const[e,i]of this._menuGroups){const n=i.map(r=>new kr(r));t.push([e,n])}return t}}class Ur extends W{createMenu(t){return new Kr(t)}}class Hr{_contextMenuService=new Fr;_menuService=new Ur;_getMenuActions(){const e=this._menuService.createMenu(H.EditorContext).getActions(),i=[];for(const[n,r]of e)i.push(...r),i.push(new J);return i.length&&i.pop(),i}showContextMenu(t){const e=this._getMenuActions();e.length!==0&&this._contextMenuService.showContextMenu({getActions:()=>e,getAnchor:()=>t||{x:100,y:100}})}}window.latte=qe;class Yr extends W{constructor(t){super(),this._domElement=t,this._lifecycleService=new Hn,this.init(),this._lifecycleService.phase=he.Ready}_modelData;_viewModel;_view;_renderService;_renderElementObserver;_cameraService;_commandService;_keybindingService;_configurationService;_lifecycleService;_contextMenu;_getViewModel(){return this._viewModel}getCameraService(){return this._cameraService}init(){this._renderElementObserver=new gr(this._domElement),this._cameraService=new yr(this._renderElementObserver.canvasSize),this._modelData=new ks(On),this._viewModel=new Sn(this._modelData,this._cameraService),this._renderService=new _r(this._domElement),this._view=new pr(this._viewModel,this._renderService,this._domElement),this._view.render(),this._commandService=new Er,this._keybindingService=new Tr(this._commandService),this._configurationService=new Pr,this._contextMenu=new Hr,this._domElement.addEventListener("contextmenu",t=>{t.preventDefault(),this._contextMenu.showContextMenu({x:t.clientX,y:t.clientY})}),window.test=this._contextMenu}dispose(){this._view.dispose(),this._renderElementObserver.dispose(),this._cameraService.dispose(),this._commandService.dispose(),this._keybindingService.dispose(),this._configurationService.dispose(),this._lifecycleService.phase=he.Destroy,this._lifecycleService.dispose(),super.dispose()}}class Wr extends ws{createContentArea(t,e){const i=this._createCanvas(t);return new Yr(i),i}_createCanvas(t){const{width:e,height:i}=t.getBoundingClientRect(),n=document.createElement("canvas");return n.setAttribute("width",String(e)),n.setAttribute("height",String(i)),n.style.width=`${e}px`,n.style.height=`${i}px`,t.appendChild(n),n}}var ke=Ue();const Xr=()=>{const s=ke.useRef();return ke.useEffect(()=>{s.current&&new Wr("workbench.parts.editor").create(s.current)},[]),It.jsx(It.Fragment,{children:It.jsx("div",{ref:s,className:"editor"})})};var Tt={},Ke;function jr(){if(Ke)return Tt;Ke=1;var s=gs();return Tt.createRoot=s.createRoot,Tt.hydrateRoot=s.hydrateRoot,Tt}var Gr=jr();const Zr=document.getElementById("root"),zr=Gr.createRoot(Zr);zr.render(It.jsx(Xr,{}));
